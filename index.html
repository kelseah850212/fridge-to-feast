<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>InventaPlate - AI Recipe Generator From Your Ingredients</title>
    <meta name="description" content="Turn your leftovers into a feast! InventaPlate is an AI-powered recipe generator that creates delicious meal ideas from the ingredients you already have in your fridge.">
    <meta name="keywords" content="AI recipe generator, recipe from ingredients, leftover recipes, what to cook, pantry recipes, InventaPlate, AI é£Ÿè­œ, é£Ÿææœå°‹é£Ÿè­œ">

    <!-- Google tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RQYJNTJQ1D"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-RQYJNTJQ1D');
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5498579882044646"
         crossorigin="anonymous"></script>

    <link rel="manifest" href="data:application/manifest+json;base64,ew0KICAibmFtZSI6ICJJbnZlbnRhUGxhdGUiLA0KICAic2hvcnRfbmFtZSI6ICJJbnZlbnRhUGxhdGUiLA0KICAiaWNvbnMiOiBbDQogICAgew0KICAgICAgInNyYyI6ICJodHRwczovL3BsYWNlaG9sZC5jby8xOTJ4MTkyLzAwQTA4MC9GRkZGRkY/dGV4dD1JUCIgLA0KICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIiwNCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIg0KICAgIH0sDQogICAgew0KICAgICAgInNyYyI6ICJodHRwczovL3BsYWNlaG9sZC5jby81MTJ4NTEyLzAwQTA4MC9GRkZGRkY/dGV4dD1JUCIgLA0KICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIiwNCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIg0KICAgIH0NCiAgXSwNCiAgInN0YXJ0X3VybCI6ICIuIiwNCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsDQogICJ0aGVtZV9jb2xvciI6ICIjMTBCOTgxIiwNCiAgImJhY2tncm91bmRfY29sb3IiOiAiI0Y5RkFGQiINCn0=">
    <meta name="theme-color" content="#10B981">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Poppins:wght@400;500;700&display=swap');
        /* Font Fix: Explicitly define a robust font stack for better consistency */
        body { 
            font-family: 'Poppins', 'Noto Sans TC', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            scroll-behavior: smooth; 
        }
        .style-btn, .preference-btn, .popular-search-btn, #lang-switcher, #my-favorites-btn { transition: all 0.2s ease-in-out; }
        .style-btn:hover, .popular-search-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .preference-btn.active {
            background-color: #10B981; color: white; border-color: #10B981;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
        }
        .favorite-btn {
            position: absolute; top: 1rem; right: 1rem;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 9999px; width: 2.5rem; height: 2.5rem;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.25rem; color: #fbbf24;
            transition: all 0.2s ease-in-out;
            z-index: 10; cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .favorite-btn:hover { 
            transform: scale(1.1); 
            background-color: rgba(255, 255, 255, 1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .favorite-btn.saved { 
            background-color: #fbbf24;
            color: white;
        }
        .favorite-btn.saved:hover {
            background-color: #f59e0b;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #10B981;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* é”™è¯¯æç¤ºæ ·å¼ */
        .error-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fbbf24 100%);
            border-left: 4px solid #f59e0b;
        }
        
        /* é‡è¯•æŒ‰é’®æ ·å¼ */
        .retry-btn {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            transition: all 0.3s ease;
        }
        .retry-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        /* Modal æ ·å¼ */
        .modal-overlay {
            position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5);
            display: flex; align-items: center; justify-content: center;
            z-index: 50; opacity: 0; transition: opacity 0.3s ease; pointer-events: none;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-content {
            background: white; padding: 2rem; border-radius: 0.75rem;
            max-width: 90%; width: 600px; max-height: 80vh; overflow-y: auto;
            transform: scale(0.95); transition: transform 0.3s ease;
        }
        .modal-overlay.active .modal-content { transform: scale(1); }
        
        /* PWA å®‰è£…æç¤ºæ ·å¼ */
        #install-hint {
            animation: fadeInOut 15s ease-in-out forwards;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- PWA å®‰è£…æç¤º -->
    <div id="install-hint" class="hidden fixed top-20 right-4 bg-blue-500 text-white text-xs px-3 py-2 rounded-lg shadow-lg z-50">
        <span data-translate="install_hint_text">é»æ“Šå³ä¸Šè§’åœ–æ¨™ï¼Œå³å¯å°‡æ‡‰ç”¨ç¨‹å¼ä¸‹è¼‰åˆ°æ‰‹æ©Ÿæ¡Œé¢ï¼</span>
        <div class="absolute -top-1 right-4 w-3 h-3 bg-blue-500 transform rotate-45"></div>
    </div>


    <div class="container mx-auto max-w-2xl p-4 relative pb-24">
        <div class="flex justify-end items-center gap-2 mb-4">
            <button id="my-favorites-btn" class="text-sm font-semibold text-gray-600 hover:text-green-500 py-2 px-3 bg-white rounded-lg shadow-sm border">
                <i class="fas fa-star mr-1 text-amber-400"></i>
                <span data-translate="my_favorites">æˆ‘çš„æœ€æ„›</span>
            </button>
            <button id="lang-switcher" class="text-sm font-semibold text-gray-600 hover:text-green-500 py-2 px-3 bg-white rounded-lg shadow-sm border">English</button>
        </div>
        
        <header class="text-center my-8">
            <h1 class="text-4xl font-bold text-gray-800" data-translate="main_title">InventaPlate</h1>
            <p class="text-gray-500 mt-2" data-translate="subtitle">è¼¸å…¥é£Ÿææ‰¾éˆæ„Ÿï¼Œæˆ–ç›´æ¥æœå°‹èœåï¼</p>
            
            <div class="mt-6 mb-4">
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 p-3 rounded-lg shadow-sm">
                    <div class="flex items-center justify-center">
                        <div class="flex items-center">
                            <i class="fas fa-info-circle text-blue-500 text-sm mr-2"></i>
                            <span class="text-sm text-blue-700 font-medium" data-translate="warm_reminder_title">ğŸ’¡ æº«é¦¨æç¤º</span>
                        </div>
                    </div>
                    <div class="mt-2 text-center">
                        <p class="text-xs text-blue-600" data-translate="warm_reminder_text">æœ¬ç«™ä½¿ç”¨çœŸå¯¦ AI é€²è¡Œé£Ÿè­œç”Ÿæˆï¼Œä¸¦éå‚³çµ±æœç´¢åŠŸèƒ½ã€‚æˆ‘å€‘è‡´åŠ›æ–¼ç‚ºæ‚¨å‰µé€ ç¨ç‰¹çš„çƒ¹é£ªéˆæ„Ÿï¼Œä½† AI æœå‹™å™¨å¶çˆ¾å¯èƒ½æœƒç¹å¿™ï¼Œè«‹æ‚¨è¦‹è«’ã€‚å»ºè­°å°‡å–œæ„›çš„é£Ÿè­œæ”¶è—èµ·ä¾†ï¼Œæ–¹ä¾¿éš¨æ™‚æŸ¥çœ‹ï¼</p>
                    </div>
                    <div class="mt-2 flex justify-center gap-2">
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700">
                            <i class="fas fa-robot mr-1 text-xs"></i>çœŸå¯¦ AI
                        </span>
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700">
                            <i class="fas fa-lightbulb mr-1 text-xs"></i>å‰µæ„ç„¡é™
                        </span>
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-700">
                            <i class="fas fa-heart mr-1 text-xs"></i>ç”¨å¿ƒæœå‹™
                        </span>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="bg-white p-6 rounded-xl shadow-md">
            <div class="flex items-center border-2 border-gray-200 rounded-lg focus-within:border-green-500 transition-colors">
                <i class="fas fa-utensils text-gray-400 mx-3"></i>
                <input type="text" id="main-input" class="w-full p-3 outline-none" placeholder="ä¾‹å¦‚: é›è›‹, ç•ªèŒ„">
                <button id="start-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-r-lg transition-colors">
                    <i class="fas fa-search mr-2"></i><span data-translate="start_button">é–‹å§‹</span>
                </button>
            </div>
            <div id="preferences-container" class="mt-4 flex flex-wrap justify-center gap-3">
                <button class="preference-btn py-2 px-4 bg-white border-2 border-gray-200 rounded-full text-sm font-semibold text-gray-600" data-preference="vegetarian" data-translate="pref_vegetarian">ç´ é£Ÿ</button>
                <button class="preference-btn py-2 px-4 bg-white border-2 border-gray-200 rounded-full text-sm font-semibold text-gray-600" data-preference="low-calorie" data-translate="pref_low_calorie">ä½ç†±é‡</button>
                <button class="preference-btn py-2 px-4 bg-white border-2 border-gray-200 rounded-full text-sm font-semibold text-gray-600" data-preference="spicy" data-translate="pref_spicy">è¦è¾£</button>
            </div>
        </div>
        
        <div id="initial-content-container" class="mt-8">
             <!-- Initial content is now dynamically managed by JS -->
        </div>

        <div id="result-container" class="mt-8 grid gap-8"></div>
        
        <footer class="text-center mt-12 py-6 border-t border-gray-200">
            <div class="flex justify-center gap-4 text-sm text-gray-500">
                <a href="#about-us" class="hover:text-green-500" data-translate="footer_about">é—œæ–¼æˆ‘å€‘</a>
                <a href="#faq" class="hover:text-green-500" data-translate="footer_faq">å¸¸è¦‹å•é¡Œ</a>
                <a href="#" id="terms-link" class="hover:text-green-500" data-translate="footer_terms">æœå‹™æ¢æ¬¾</a>
                <a href="#" id="privacy-link" class="hover:text-green-500" data-translate="footer_privacy">éš±ç§æ”¿ç­–</a>
            </div>
            <p class="text-xs text-gray-400 mt-4" data-translate="footer_copyright">Â© 2025 InventaPlate. All Rights Reserved.</p>
        </footer>
    </div>

    <!-- Modals -->
    <div id="modal-terms" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4" data-translate="terms_title">æœå‹™æ¢æ¬¾</h2>
            <p class="text-sm text-gray-600" data-translate="terms_content">æ­¡è¿ä½¿ç”¨ InventaPlateï¼ä½¿ç”¨æœ¬ç¶²ç«™å³è¡¨ç¤ºæ‚¨åŒæ„ä»¥ä¸‹æ¢æ¬¾ï¼šæœ¬æœå‹™æä¾›çš„æ‰€æœ‰é£Ÿè­œå’Œå»ºè­°åƒ…ä¾›åƒè€ƒï¼Œä½¿ç”¨è€…æ‡‰è‡ªè¡Œåˆ¤æ–·å…¶é©ç”¨æ€§èˆ‡å®‰å…¨æ€§ã€‚æˆ‘å€‘ä¸å°å› ä½¿ç”¨æœ¬ç¶²ç«™å…§å®¹è€Œå°è‡´çš„ä»»ä½•ç›´æ¥æˆ–é–“æ¥æå¤±è² è²¬ã€‚æˆ‘å€‘ä¿ç•™éš¨æ™‚ä¿®æ”¹æˆ–çµ‚æ­¢æœå‹™çš„æ¬Šåˆ©ï¼Œæ•ä¸å¦è¡Œé€šçŸ¥ã€‚ç¦æ­¢ä»»ä½•æ¿«ç”¨æœ¬æœå‹™ï¼ˆå¦‚æƒ¡æ„çˆ¬å–æ•¸æ“šï¼‰çš„è¡Œç‚ºã€‚</p>
            <button class="modal-close-btn mt-6 bg-green-500 text-white px-4 py-2 rounded-lg" data-translate="close_button">é—œé–‰</button>
        </div>
    </div>
    <div id="modal-privacy" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4" data-translate="privacy_title">éš±ç§æ”¿ç­–</h2>
            <p class="text-sm text-gray-600" data-translate="privacy_content">æœ¬éš±ç§æ”¿ç­–ï¼ˆæœ€å¾Œæ›´æ–°æ–¼2025å¹´8æœˆ17æ—¥ï¼‰æ—¨åœ¨èªªæ˜æˆ‘å€‘å¦‚ä½•æ”¶é›†ã€ä½¿ç”¨å’Œä¿è­·æ‚¨çš„ä¿¡æ¯ã€‚æˆ‘å€‘å°Šé‡æ‚¨çš„éš±ç§æ¬Šï¼Œä¸¦è‡´åŠ›æ–¼ä¿è­·æ‚¨çš„å€‹äººæ•¸æ“šã€‚æˆ‘å€‘é€šé Google Analytics æ”¶é›†åŒ¿åçš„ä½¿ç”¨æ•¸æ“šï¼ˆå¦‚é é¢ç€è¦½é‡ã€è¨­å‚™é¡å‹ï¼‰ï¼Œä»¥æ”¹å–„æœå‹™è³ªé‡ï¼Œé€™äº›æ•¸æ“šä¸åŒ…å«å€‹äººèº«ä»½ä¿¡æ¯ã€‚æˆ‘å€‘ä½¿ç”¨ç€è¦½å™¨çš„ LocalStorage æŠ€è¡“ä¾†ä¿å­˜æ‚¨çš„èªè¨€åå¥½å’Œæ”¶è—çš„é£Ÿè­œï¼Œé€™äº›ä¿¡æ¯åƒ…å­˜å„²åœ¨æ‚¨çš„è¨­å‚™ä¸Šï¼Œæˆ‘å€‘ç„¡æ³•è¨ªå•ã€‚æˆ‘å€‘ä½¿ç”¨ Google AdSense å±•ç¤ºå»£å‘Šï¼ŒGoogle å¯èƒ½æœƒæ ¹æ“šæ‚¨çš„ç€è¦½è¡Œç‚ºä½¿ç”¨ Cookie ä¾†æŠ•æ”¾å€‹æ€§åŒ–å»£å‘Šã€‚æ‚¨å¯ä»¥é€šé Google çš„å»£å‘Šè¨­ç½®ä¾†ç®¡ç†æ‚¨çš„å»£å‘Šåå¥½ã€‚æˆ‘å€‘æ‰¿è«¾ä¸æœƒå°‡æ‚¨çš„ä»»ä½•æ•¸æ“šå‡ºå”®æˆ–åˆ†äº«çµ¦ç¬¬ä¸‰æ–¹ã€‚è‹¥æ‚¨å°æœ¬æ”¿ç­–æœ‰ä»»ä½•ç–‘å•ï¼Œè«‹èˆ‡æˆ‘å€‘è¯ç¹«ã€‚</p>
            <button class="modal-close-btn mt-6 bg-green-500 text-white px-4 py-2 rounded-lg" data-translate="close_button">é—œé–‰</button>
        </div>
    </div>

    <!-- Templates -->
    <template id="initial-content-template">
        <div class="space-y-8">
            <!-- Main Content Card -->
            <div class="bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-2xl font-bold text-gray-800 mb-4" data-translate="welcome_title">æ­¡è¿ä¾†åˆ° InventaPlateï¼</h2>
                <p class="text-gray-600 mb-6" data-translate="welcome_text">å†ä¹Ÿä¸ç”¨ç…©æƒ±å†°ç®±è£¡çš„é£Ÿæèƒ½åšä»€éº¼èœã€‚æˆ‘å€‘åˆ©ç”¨ AI ç‚ºæ‚¨å‰µé€ ç¾å‘³é£Ÿè­œï¼Œå°‡å‰©é¤˜é£Ÿæè®Šæˆé¤æ¡Œä¸Šçš„ç››å®´ï¼</p>
                
                <div class="bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-lg mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3" data-translate="daily_tips_title">ğŸ’¡ ä»Šæ—¥çƒ¹é¥ªå°è´´å£«</h3>
                    <div class="grid md:grid-cols-2 gap-4 text-sm">
                        <div class="bg-white p-3 rounded-lg shadow-sm">
                            <h4 class="font-medium text-green-600 mb-1" data-translate="tip_storage_title">ğŸ¥¬ é£Ÿæä¿å­˜</h4>
                            <p class="text-gray-600" data-translate="tip_storage_content">ç»¿å¶è”¬èœç”¨æ¹¿çº¸å·¾åŒ…è£¹åæ”¾å…¥ä¿é²œè¢‹ï¼Œå¯å»¶é•¿3-5å¤©æ–°é²œåº¦</p>
                        </div>
                        <div class="bg-white p-3 rounded-lg shadow-sm">
                            <h4 class="font-medium text-blue-600 mb-1" data-translate="tip_seasoning_title">ğŸ§‚ è°ƒå‘³æŠ€å·§</h4>
                            <p class="text-gray-600" data-translate="tip_seasoning_content">ç‚’èœæ—¶ç›è¦åˆ†ä¸¤æ¬¡æ”¾ï¼šç‚’åˆ¶ä¸­æœŸå°‘è®¸ï¼Œèµ·é”…å‰è°ƒå‘³</p>
                        </div>
                    </div>
                </div>

                <h3 class="text-xl font-semibold text-gray-700 border-b-2 border-green-500 pb-2 mb-4" data-translate="how_to_use_title">å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h3>
                <ol class="list-decimal list-inside space-y-2 text-gray-600 mb-6">
                    <li data-translate="step1_text">åœ¨ä¸Šé¢çš„æœå°‹æ¡†ä¸­ï¼Œè¼¸å…¥æ‚¨æ“æœ‰çš„é£Ÿæï¼ˆä¾‹å¦‚ï¼šé›è›‹, ç•ªèŒ„, æ´‹è”¥ï¼‰ã€‚</li>
                    <li data-translate="step2_text">é¸æ“‡æ‚¨çš„é£²é£Ÿåå¥½ï¼ˆä¾‹å¦‚ï¼šç´ é£Ÿã€è¦è¾£ï¼‰ã€‚</li>
                    <li data-translate="step3_text">é»æ“Šã€Œé–‹å§‹ã€ï¼Œè®“æˆ‘å€‘çš„ AI ç‚ºæ‚¨è®Šå‡ºé­”æ³•ï¼</li>
                </ol>

                <div class="bg-yellow-50 p-4 rounded-lg mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3" data-translate="nutrition_knowledge_title">ğŸŒŸ è¥å…»æ­é…å°çŸ¥è¯†</h3>
                    <div class="space-y-2 text-sm text-gray-600">
                        <p data-translate="nutrition_combo1"><strong>è›‹ç™½è´¨+ç»´ç”Ÿç´ Cï¼š</strong>ç‰›è‚‰é…ç•ªèŒ„ï¼Œä¿ƒè¿›é“è´¨å¸æ”¶</p>
                        <p data-translate="nutrition_combo2"><strong>é’™è´¨+ç»´ç”Ÿç´ Dï¼š</strong>è±†è…é…é±¼ç±»ï¼Œå¼ºåŒ–éª¨éª¼å¥åº·</p>
                        <p data-translate="nutrition_combo3"><strong>è†³é£Ÿçº¤ç»´ï¼š</strong>æ¯é¤è‡³å°‘ä¸€ç§ç»¿å¶è”¬èœï¼Œä¿ƒè¿›æ¶ˆåŒ–</p>
                    </div>
                </div>

                <h3 class="text-xl font-semibold text-gray-700 mb-4" data-translate="popular_searches_title">ç†±é–€æœå°‹</h3>
                <div id="popular-searches-container" class="flex flex-wrap gap-3 mb-6">
                    <button class="popular-search-btn bg-green-100 text-green-700 py-2 px-4 rounded-full font-semibold" data-search="é›è›‹">ğŸ³ é›è›‹</button>
                    <button class="popular-search-btn bg-blue-100 text-blue-700 py-2 px-4 rounded-full font-semibold" data-search="é›è‚‰">ğŸ— é›è‚‰</button>
                    <button class="popular-search-btn bg-red-100 text-red-700 py-2 px-4 rounded-full font-semibold" data-search="ç•ªèŒ„">ğŸ… ç•ªèŒ„</button>
                    <button class="popular-search-btn bg-yellow-100 text-yellow-700 py-2 px-4 rounded-full font-semibold" data-search="é¦¬éˆ´è–¯">ğŸ¥” é¦¬éˆ´è–¯</button>
                    <button class="popular-search-btn bg-teal-100 text-teal-700 py-2 px-4 rounded-full font-semibold" data-search="æ“‚èŒ¶">ğŸµ æ“‚èŒ¶</button>
                    <button class="popular-search-btn bg-purple-100 text-purple-700 py-2 px-4 rounded-full font-semibold" data-search="è±†è…">ğŸ§ˆ è±†è…</button>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3" data-translate="healthy_eating_title">ğŸ½ï¸ å¥åº·é¥®é£ŸæŒ‡å—</h3>
                    <div class="grid md:grid-cols-3 gap-3 text-sm">
                        <div class="text-center p-2 bg-white rounded">
                            <div class="text-2xl mb-1">ğŸ¥—</div>
                            <div class="font-medium" data-translate="healthy_item1_name">è”¬èœæ°´æœ</div>
                            <div class="text-gray-600" data-translate="healthy_item1_desc">æ¯æ—¥5ä»½</div>
                        </div>
                        <div class="text-center p-2 bg-white rounded">
                            <div class="text-2xl mb-1">ğŸ—</div>
                            <div class="font-medium" data-translate="healthy_item2_name">ä¼˜è´¨è›‹ç™½</div>
                            <div class="text-gray-600" data-translate="healthy_item2_desc">æ¯é¤1ä»½</div>
                        </div>
                        <div class="text-center p-2 bg-white rounded">
                            <div class="text-2xl mb-1">ğŸŒ¾</div>
                            <div class="font-medium" data-translate="healthy_item3_name">å…¨è°·ç‰©</div>
                            <div class="text-gray-600" data-translate="healthy_item3_desc">æ›¿ä»£ç²¾åˆ¶è°·ç‰©</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- More Content Section (RESTORED) -->
            <div class="bg-gray-100 p-4 rounded-xl">
                <h3 class="text-lg font-semibold text-gray-700 mb-3" data-translate="more_content_title">ğŸ“š æ›´å¤šå†…å®¹</h3>
                <div class="grid md:grid-cols-2 gap-3">
                    <a href="javascript:void(0);" class="block p-3 bg-white rounded-lg hover:bg-green-50 transition-colors" onclick="showCookingTips()">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">ğŸ‘¨â€ğŸ³</span>
                            <div>
                                <div class="font-medium" data-translate="more_link1_title">çƒ¹é¥ªæŠ€å·§å¤§å…¨</div>
                                <div class="text-sm text-gray-600" data-translate="more_link1_desc">ä¸“ä¸šå¨å¸ˆåˆ†äº«çš„å®ç”¨æŠ€å·§</div>
                            </div>
                        </div>
                    </a>
                    <a href="javascript:void(0);" class="block p-3 bg-white rounded-lg hover:bg-blue-50 transition-colors" onclick="showNutritionGuide()">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">ğŸ¥‘</span>
                            <div>
                                <div class="font-medium" data-translate="more_link2_title">è¥å…»æ­é…æŒ‡å—</div>
                                <div class="text-sm text-gray-600" data-translate="more_link2_desc">ç§‘å­¦çš„è¥å…»æ­é…åŸåˆ™</div>
                            </div>
                        </div>
                    </a>
                    <a href="javascript:void(0);" class="block p-3 bg-white rounded-lg hover:bg-yellow-50 transition-colors" onclick="showStorageGuide()">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">ğŸ§Š</span>
                            <div>
                                <div class="font-medium" data-translate="more_link3_title">é£Ÿæä¿å­˜ç§˜ç±</div>
                                <div class="text-sm text-gray-600" data-translate="more_link3_desc">å»¶é•¿é£Ÿææ–°é²œåº¦çš„æ–¹æ³•</div>
                            </div>
                        </div>
                    </a>
                    <a href="javascript:void(0);" class="block p-3 bg-white rounded-lg hover:bg-purple-50 transition-colors" onclick="showSeasonalRecipes()">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">ğŸŒ¸</span>
                            <div>
                                <div class="font-medium" data-translate="more_link4_title">æ—¶ä»¤é£Ÿè°±æ¨è</div>
                                <div class="text-sm text-gray-600" data-translate="more_link4_desc">æ ¹æ®å­£èŠ‚æ¨èæœ€ä½³é£Ÿæ</div>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
            
            <!-- Static Content for SEO -->
            <div class="bg-white p-6 rounded-xl shadow-md space-y-8">
                <!-- About Us Section -->
                <div id="about-us">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4" data-translate="about_title">é—œæ–¼ InventaPlate</h2>
                    <p class="text-gray-600" data-translate="about_content">InventaPlate èª•ç”Ÿæ–¼ä¸€å€‹ç°¡å–®çš„æƒ³æ³•ï¼šè®“çƒ¹é£ªè®Šå¾—æ›´æœ‰è¶£ã€æ›´è¼•é¬†ï¼Œä¸¦æ¸›å°‘é£Ÿç‰©æµªè²»ã€‚æˆ‘å€‘åˆ©ç”¨å…ˆé€²çš„ AI æŠ€è¡“ï¼Œå°‡æ‚¨å†°ç®±ä¸­é›¶æ•£çš„é£Ÿæï¼Œè½‰åŒ–ç‚ºä»¤äººé©šå–œçš„ç¾å‘³ä½³é¤šã€‚ç„¡è«–æ‚¨æ˜¯çƒ¹é£ªæ–°æ‰‹é‚„æ˜¯ç¶“é©—è±å¯Œçš„å»šå¸«ï¼Œæˆ‘å€‘éƒ½å¸Œæœ›èƒ½æ¿€ç™¼æ‚¨çš„çƒ¹é£ªéˆæ„Ÿï¼Œè®“æ¯ä¸€é¤éƒ½æˆç‚ºä¸€å ´ç››å®´ã€‚</p>
                </div>

                <!-- FAQ Section -->
                <div id="faq">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4" data-translate="faq_title">å¸¸è¦‹å•é¡Œ</h2>
                    <div class="space-y-4">
                        <div>
                            <h3 class="font-semibold" data-translate="faq_q1_title">Q1: é€™å€‹æœå‹™æ˜¯å…è²»çš„å—ï¼Ÿ</h3>
                            <p class="text-gray-600" data-translate="faq_q1_content">æ˜¯çš„ï¼Œæˆ‘å€‘çš„æ ¸å¿ƒé£Ÿè­œç”ŸæˆåŠŸèƒ½å®Œå…¨å…è²»ã€‚æˆ‘å€‘é€šéç¶²ç«™ä¸Šçš„å»£å‘Šä¾†ç¶­æŒé‹ç‡Ÿï¼Œæ„Ÿè¬æ‚¨çš„æ”¯æŒã€‚</p>
                        </div>
                        <div>
                            <h3 class="font-semibold" data-translate="faq_q2_title">Q2: AI ç”Ÿæˆçš„é£Ÿè­œå¯é å—ï¼Ÿ</h3>
                            <p class="text-gray-600" data-translate="faq_q2_content">æˆ‘å€‘çš„ AI ç¶“éå¤§é‡é£Ÿè­œæ•¸æ“šçš„è¨“ç·´ï¼Œèƒ½æä¾›å¯Œæœ‰å‰µæ„ä¸”å¯¦ç”¨çš„çƒ¹é£ªå»ºè­°ã€‚ä½† AI ä¸¦éå®Œç¾ï¼Œæˆ‘å€‘å»ºè­°æ‚¨åœ¨çƒ¹é£ªæ™‚ä»å¯æ ¹æ“šè‡ªå·±çš„å£å‘³å’Œç¶“é©—é€²è¡Œå¾®èª¿ã€‚</p>
                        </div>
                        <div>
                            <h3 class="font-semibold" data-translate="faq_q3_title">Q3: ç‚ºä»€éº¼æœ‰æ™‚å€™ç”Ÿæˆé£Ÿè­œæœƒå¤±æ•—ï¼Ÿ</h3>
                            <p class="text-gray-600" data-translate="faq_q3_content">ç”±æ–¼ AI æœå‹™å™¨éœ€è¦å·¨å¤§çš„è¨ˆç®—è³‡æºï¼Œåœ¨é«˜å³°æ™‚æ®µï¼ˆå¦‚æ™šé¤æ™‚é–“ï¼‰å¯èƒ½æœƒå‡ºç¾æ“å µæˆ–éŸ¿æ‡‰ç·©æ…¢ã€‚å¦‚æœé‡åˆ°é€™ç¨®æƒ…æ³ï¼Œè«‹ç¨å¾Œå†è©¦ï¼Œæˆ–å˜—è©¦ä½¿ç”¨æˆ‘å€‘æ¨è–¦çš„ç†±é–€æœå°‹ã€‚</p>
                        </div>
                        <div>
                            <h3 class="font-semibold" data-translate="faq_q4_title">Q4: æˆ‘å¯ä»¥ä¿å­˜æˆ‘å–œæ­¡çš„é£Ÿè­œå—ï¼Ÿ</h3>
                            <p class="text-gray-600" data-translate="faq_q4_content">ç•¶ç„¶å¯ä»¥ï¼åœ¨æ¯å€‹é£Ÿè­œå¡çš„å³ä¸Šè§’éƒ½æœ‰ä¸€å€‹æ˜Ÿè™ŸæŒ‰éˆ•ï¼Œé»æ“Šå³å¯å°‡é£Ÿè­œæ”¶è—åˆ°ã€Œæˆ‘çš„æœ€æ„›ã€ï¼Œæ–¹ä¾¿æ‚¨éš¨æ™‚æŸ¥çœ‹ï¼Œå³ä½¿åœ¨é›¢ç·šç‹€æ…‹ä¸‹ä¹Ÿå¯ä»¥ã€‚</p>
                        </div>
                         <div>
                            <h3 class="font-semibold" data-translate="faq_q5_title">Q5: åœ–ç‰‡æ˜¯çœŸå¯¦æ‹æ”çš„å—ï¼Ÿ</h3>
                            <p class="text-gray-600" data-translate="faq_q5_content">é£Ÿè­œåœ–ç‰‡æ˜¯ç”± AI æ ¹æ“šé£Ÿè­œå…§å®¹ç”Ÿæˆçš„ï¼Œæ—¨åœ¨ç‚ºæ‚¨æä¾›èœå“å¤–è§€çš„éˆæ„Ÿï¼Œåƒ…ä¾›åƒè€ƒã€‚å¯¦éš›æˆå“å¯èƒ½æœƒå› é£Ÿæå’Œçƒ¹é£ªæŠ€å·§è€Œæœ‰æ‰€ä¸åŒã€‚</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>
    
    <template id="favorites-view-template">
        <div class="bg-white p-6 rounded-xl shadow-md">
            <h2 class="text-2xl font-bold text-gray-800 mb-4" data-translate="favorites_title">æˆ‘çš„æœ€æ„›é£Ÿè­œ</h2>
            <p id="no-favorites-text" class="text-gray-500" data-translate="no_favorites_text">æ‚¨é‚„æ²’æœ‰æ”¶è—ä»»ä½•é£Ÿè­œã€‚çœ‹åˆ°å–œæ­¡çš„é£Ÿè­œæ™‚ï¼Œé»æ“Šå³ä¸Šè§’çš„æ˜Ÿè™Ÿå°±å¯ä»¥æ”¶è—èµ·ä¾†ï¼</p>
        </div>
    </template>
    
    <template id="recipe-card-template">
        <div class="bg-white p-6 rounded-xl shadow-lg relative">
            <button class="favorite-btn" title="åŠ å…¥æˆ‘çš„æœ€æ„›">
                <i class="far fa-star"></i>
            </button>
            <div class="relative">
                <img class="recipe-image w-full h-64 object-cover rounded-lg mb-4 shadow-md" src="" alt="Recipe Image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/CCCCCC/FFFFFF?text=Image+Error';">
                <div class="absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded" data-translate="image_ref_note">å›¾ç‰‡åªä¾›å‚è€ƒ</div>
            </div>
            <div class="favorite-reminder text-sm text-center text-gray-500 mb-4 italic" data-translate="favorite_reminder">å–œæ­¡é€™é“èœï¼Ÿé»æ“Šæ˜Ÿè™Ÿæ”¶è—ï¼Œéš¨æ™‚é›¢ç·šæŸ¥çœ‹ï¼</div>
            <h2 class="recipe-name text-3xl font-bold text-gray-800 mb-2"></h2>
            <p class="text-gray-600 mb-4">
                <i class="fas fa-fire-alt mr-2 text-red-500"></i>
                <span data-translate="calories_label">é ä¼°å¡è·¯é‡Œ</span>: 
                <span class="recipe-calories"></span> 
                <span class="text-xs text-gray-400" data-translate="calories_note">(ä¼°ç®—å€¼)</span>
            </p>
            <div class="mt-6">
                <h3 class="text-xl font-semibold text-gray-700 border-b-2 border-green-500 pb-2 mb-4" data-translate="ingredients_label">æ‰€éœ€é£Ÿæ</h3>
                <ul class="recipe-ingredients list-disc list-inside space-y-2 text-gray-600"></ul>
            </div>
            <div class="mt-6">
                <h3 class="text-xl font-semibold text-gray-700 border-b-2 border-green-500 pb-2 mb-4" data-translate="instructions_label">åšæ³•</h3>
                <div class="recipe-instructions space-y-3 text-gray-600 leading-relaxed"></div>
            </div>
        </div>
    </template>
    
    <template id="error-message-template">
        <div class="error-card p-6 rounded-xl shadow-lg" role="alert">
            <div class="flex items-center mb-4">
                <i class="fas fa-exclamation-triangle text-yellow-600 text-2xl mr-3"></i>
                <h3 class="text-xl font-bold text-gray-800 error-title">AI å»šå¸«æ­£åœ¨å¿™ç¢Œä¸­ï¼</h3>
            </div>
            <div class="error-content mb-6">
                <p class="text-gray-700 mb-3 error-text"></p>
                <div class="bg-white bg-opacity-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-600 mb-2"><strong>ğŸ’¡ å»ºè­°è§£æ±ºæ–¹æ¡ˆï¼š</strong></p>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>â€¢ ç­‰å¾… 30-60 ç§’å¾Œé‡è©¦</li>
                        <li>â€¢ é¿é–‹ä½¿ç”¨é«˜å³°æœŸï¼ˆæ™šé¤æ™‚é–“ 6-8pmï¼‰</li>
                        <li>â€¢ å°‡å–œæ­¡çš„é£Ÿè­œå…ˆæ”¶è—èµ·ä¾†ï¼Œé¿å…é‡æ–°ç”Ÿæˆ</li>
                        <li>â€¢ å˜—è©¦ç°¡åŒ–æœç´¢å…§å®¹</li>
                    </ul>
                </div>
            </div>
            <div class="flex gap-3">
                <button class="retry-btn text-white px-6 py-3 rounded-lg font-semibold flex items-center">
                    <i class="fas fa-redo mr-2"></i>
                    <span class="retry-text">é‡è©¦</span>
                </button>
                <button class="back-home-btn bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                    <i class="fas fa-home mr-2"></i>
                    è¿”å›é¦–é 
                </button>
            </div>
        </div>
    </template>

    <script>
        // --- ç¿»è­¯ç³»çµ± (å®Œæ•´ç‰ˆ) ---
        const translations = {
            zh: { 
                lang_switcher: "English", main_title: "InventaPlate", subtitle: "è¼¸å…¥é£Ÿææ‰¾éˆæ„Ÿï¼Œæˆ–ç›´æ¥æœå°‹èœåï¼", input_placeholder: "ä¾‹å¦‚: é›è›‹, ç•ªèŒ„", start_button: "é–‹å§‹", thinking: "æ€è€ƒä¸­...", generating_recipe: "ç”Ÿæˆé£Ÿè­œä¸­...", generating_image: "ç¹ªè£½åœ–ç‰‡ä¸­...", art_director: "è˜è«‹é€ å‹å¸«...", how_to_cook: "ä½ æƒ³æ€éº¼ç…®ï¼Ÿ", ai_creative_style: "AIå‰µæ„ç…®æ³•", image_ref_note: "å›¾ç‰‡åªä¾›å‚è€ƒ", calories_label: "é ä¼°å¡è·¯é‡Œ", calories_note: "(ä¼°ç®—å€¼)", ingredients_label: "æ‰€éœ€é£Ÿæ", instructions_label: "åšæ³•", error_title: "å™¢ä¸ï¼Œå‡ºéŒ¯äº†ï¼", error_title_busy: "AI å»šå¸«æ­£åœ¨å¿™ç¢Œä¸­ï¼", error_busy_text: "ä¼ºæœå™¨ç›®å‰å¿™ç¢Œä¸­ï¼Œè«‹ç¨å¾Œé‡è©¦ã€‚å»ºè­°å…ˆå°‡å–œæ­¡çš„é£Ÿè­œæ”¶è—èµ·ä¾†ï¼", error_input_required: "è«‹è¼¸å…¥é£Ÿææˆ–èœåï¼", error_generic: "ç„¡æ³•è™•ç†æ‚¨çš„è«‹æ±‚ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚", error_recipe_gen: "ç”Ÿæˆé£Ÿè­œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚", error_timeout: "è«‹æ±‚è¶…æ™‚ï¼Œä¼ºæœå™¨éŸ¿æ‡‰è¼ƒæ…¢ã€‚", error_network: "ç¶²è·¯é€£æ¥å•é¡Œï¼Œè«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯é€£æ¥ã€‚", step_label: "æ­¥é©Ÿ", pref_vegetarian: "ç´ é£Ÿ", pref_low_calorie: "ä½ç†±é‡", pref_spicy: "è¦è¾£", welcome_title: "æ­¡è¿ä¾†åˆ° InventaPlateï¼", welcome_text: "å†ä¹Ÿä¸ç”¨ç…©æƒ±å†°ç®±è£¡çš„é£Ÿæèƒ½åšä»€éº¼èœã€‚æˆ‘å€‘åˆ©ç”¨ AI ç‚ºæ‚¨å‰µé€ ç¾å‘³é£Ÿè­œï¼Œå°‡å‰©é¤˜é£Ÿæè®Šæˆé¤æ¡Œä¸Šçš„ç››å®´ï¼", how_to_use_title: "å¦‚ä½•ä½¿ç”¨ï¼Ÿ", step1_text: "åœ¨ä¸Šé¢çš„æœå°‹æ¡†ä¸­ï¼Œè¼¸å…¥æ‚¨æ“æœ‰çš„é£Ÿæï¼ˆä¾‹å¦‚ï¼šé›è›‹, ç•ªèŒ„, æ´‹è”¥ï¼‰ã€‚", step2_text: "é¸æ“‡æ‚¨çš„é£²é£Ÿåå¥½ï¼ˆä¾‹å¦‚ï¼šç´ é£Ÿã€è¦è¾£ï¼‰ã€‚", step3_text: "é»æ“Šã€Œé–‹å§‹ã€ï¼Œè®“æˆ‘å€‘çš„ AI ç‚ºæ‚¨è®Šå‡ºé­”æ³•ï¼", popular_searches_title: "ç†±é–€æœå°‹", my_favorites: "æˆ‘çš„æœ€æ„›", favorites_title: "æˆ‘çš„æœ€æ„›é£Ÿè­œ", no_favorites_text: "æ‚¨é‚„æ²’æœ‰æ”¶è—ä»»ä½•é£Ÿè­œã€‚çœ‹åˆ°å–œæ­¡çš„é£Ÿè­œæ™‚ï¼Œé»æ“Šå³ä¸Šè§’çš„æ˜Ÿè™Ÿå°±å¯ä»¥æ”¶è—èµ·ä¾†ï¼", favorite_reminder: "å–œæ­¡é€™é“èœï¼Ÿé»æ“Šæ˜Ÿè™Ÿæ”¶è—ï¼Œéš¨æ™‚é›¢ç·šæŸ¥çœ‹ï¼", retry_text: "é‡è©¦", retrying_text: "é‡è©¦ä¸­...", back_home: "è¿”å›é¦–é ", warm_reminder_title: "ğŸ’¡ æº«é¦¨æç¤º", warm_reminder_text: "æœ¬ç«™ä½¿ç”¨çœŸå¯¦ AI é€²è¡Œé£Ÿè­œç”Ÿæˆï¼Œä¸¦éå‚³çµ±æœç´¢åŠŸèƒ½ã€‚æˆ‘å€‘è‡´åŠ›æ–¼ç‚ºæ‚¨å‰µé€ ç¨ç‰¹çš„çƒ¹é£ªéˆæ„Ÿï¼Œä½† AI æœå‹™å™¨å¶çˆ¾å¯èƒ½æœƒç¹å¿™ï¼Œè«‹æ‚¨è¦‹è«’ã€‚å»ºè­°å°‡å–œæ„›çš„é£Ÿè­œæ”¶è—èµ·ä¾†ï¼Œæ–¹ä¾¿éš¨æ™‚æŸ¥çœ‹ï¼", daily_tips_title: "ğŸ’¡ ä»Šæ—¥çƒ¹é¥ªå°è´´å£«",
                footer_about: "é—œæ–¼æˆ‘å€‘", footer_faq: "å¸¸è¦‹å•é¡Œ", footer_terms: "æœå‹™æ¢æ¬¾", footer_privacy: "éš±ç§æ”¿ç­–", footer_copyright: "Â© 2025 InventaPlate. ç‰ˆæ¬Šæ‰€æœ‰ã€‚", close_button: "é—œé–‰",
                about_title: "é—œæ–¼ InventaPlate", about_content: "InventaPlate èª•ç”Ÿæ–¼ä¸€å€‹ç°¡å–®çš„æƒ³æ³•ï¼šè®“çƒ¹é£ªè®Šå¾—æ›´æœ‰è¶£ã€æ›´è¼•é¬†ï¼Œä¸¦æ¸›å°‘é£Ÿç‰©æµªè²»ã€‚æˆ‘å€‘åˆ©ç”¨å…ˆé€²çš„ AI æŠ€è¡“ï¼Œå°‡æ‚¨å†°ç®±ä¸­é›¶æ•£çš„é£Ÿæï¼Œè½‰åŒ–ç‚ºä»¤äººé©šå–œçš„ç¾å‘³ä½³é¤šã€‚ç„¡è«–æ‚¨æ˜¯çƒ¹é£ªæ–°æ‰‹é‚„æ˜¯ç¶“é©—è±å¯Œçš„å»šå¸«ï¼Œæˆ‘å€‘éƒ½å¸Œæœ›èƒ½æ¿€ç™¼æ‚¨çš„çƒ¹é£ªéˆæ„Ÿï¼Œè®“æ¯ä¸€é¤éƒ½æˆç‚ºä¸€å ´ç››å®´ã€‚",
                faq_title: "å¸¸è¦‹å•é¡Œ", faq_q1_title: "Q1: é€™å€‹æœå‹™æ˜¯å…è²»çš„å—ï¼Ÿ", faq_q1_content: "æ˜¯çš„ï¼Œæˆ‘å€‘çš„æ ¸å¿ƒé£Ÿè­œç”ŸæˆåŠŸèƒ½å®Œå…¨å…è²»ã€‚æˆ‘å€‘é€šéç¶²ç«™ä¸Šçš„å»£å‘Šä¾†ç¶­æŒé‹ç‡Ÿï¼Œæ„Ÿè¬æ‚¨çš„æ”¯æŒã€‚", faq_q2_title: "Q2: AI ç”Ÿæˆçš„é£Ÿè­œå¯é å—ï¼Ÿ", faq_q2_content: "æˆ‘å€‘çš„ AI ç¶“éå¤§é‡é£Ÿè­œæ•¸æ“šçš„è¨“ç·´ï¼Œèƒ½æä¾›å¯Œæœ‰å‰µæ„ä¸”å¯¦ç”¨çš„çƒ¹é£ªå»ºè­°ã€‚ä½† AI ä¸¦éå®Œç¾ï¼Œæˆ‘å€‘å»ºè­°æ‚¨åœ¨çƒ¹é£ªæ™‚ä»å¯æ ¹æ“šè‡ªå·±çš„å£å‘³å’Œç¶“é©—é€²è¡Œå¾®èª¿ã€‚", faq_q3_title: "Q3: ç‚ºä»€éº¼æœ‰æ™‚å€™ç”Ÿæˆé£Ÿè­œæœƒå¤±æ•—ï¼Ÿ", faq_q3_content: "ç”±æ–¼ AI æœå‹™å™¨éœ€è¦å·¨å¤§çš„è¨ˆç®—è³‡æºï¼Œåœ¨é«˜å³°æ™‚æ®µï¼ˆå¦‚æ™šé¤æ™‚é–“ï¼‰å¯èƒ½æœƒå‡ºç¾æ“å µæˆ–éŸ¿æ‡‰ç·©æ…¢ã€‚å¦‚æœé‡åˆ°é€™ç¨®æƒ…æ³ï¼Œè«‹ç¨å¾Œå†è©¦ï¼Œæˆ–å˜—è©¦ä½¿ç”¨æˆ‘å€‘æ¨è–¦çš„ç†±é–€æœå°‹ã€‚", faq_q4_title: "Q4: æˆ‘å¯ä»¥ä¿å­˜æˆ‘å–œæ­¡çš„é£Ÿè­œå—ï¼Ÿ", faq_q4_content: "ç•¶ç„¶å¯ä»¥ï¼åœ¨æ¯å€‹é£Ÿè­œå¡çš„å³ä¸Šè§’éƒ½æœ‰ä¸€å€‹æ˜Ÿè™ŸæŒ‰éˆ•ï¼Œé»æ“Šå³å¯å°‡é£Ÿè­œæ”¶è—åˆ°ã€Œæˆ‘çš„æœ€æ„›ã€ï¼Œæ–¹ä¾¿æ‚¨éš¨æ™‚æŸ¥çœ‹ï¼Œå³ä½¿åœ¨é›¢ç·šç‹€æ…‹ä¸‹ä¹Ÿå¯ä»¥ã€‚", faq_q5_title: "Q5: åœ–ç‰‡æ˜¯çœŸå¯¦æ‹æ”çš„å—ï¼Ÿ", faq_q5_content: "é£Ÿè­œåœ–ç‰‡æ˜¯ç”± AI æ ¹æ“šé£Ÿè­œå…§å®¹ç”Ÿæˆçš„ï¼Œæ—¨åœ¨ç‚ºæ‚¨æä¾›èœå“å¤–è§€çš„éˆæ„Ÿï¼Œåƒ…ä¾›åƒè€ƒã€‚å¯¦éš›æˆå“å¯èƒ½æœƒå› é£Ÿæå’Œçƒ¹é£ªæŠ€å·§è€Œæœ‰æ‰€ä¸åŒã€‚",
                terms_title: "æœå‹™æ¢æ¬¾", terms_content: "æ­¡è¿ä½¿ç”¨ InventaPlateï¼ä½¿ç”¨æœ¬ç¶²ç«™å³è¡¨ç¤ºæ‚¨åŒæ„ä»¥ä¸‹æ¢æ¬¾ï¼šæœ¬æœå‹™æä¾›çš„æ‰€æœ‰é£Ÿè­œå’Œå»ºè­°åƒ…ä¾›åƒè€ƒï¼Œä½¿ç”¨è€…æ‡‰è‡ªè¡Œåˆ¤æ–·å…¶é©ç”¨æ€§èˆ‡å®‰å…¨æ€§ã€‚æˆ‘å€‘ä¸å°å› ä½¿ç”¨æœ¬ç¶²ç«™å…§å®¹è€Œå°è‡´çš„ä»»ä½•ç›´æ¥æˆ–é–“æ¥æå¤±è² è²¬ã€‚æˆ‘å€‘ä¿ç•™éš¨æ™‚ä¿®æ”¹æˆ–çµ‚æ­¢æœå‹™çš„æ¬Šåˆ©ï¼Œæ•ä¸å¦è¡Œé€šçŸ¥ã€‚ç¦æ­¢ä»»ä½•æ¿«ç”¨æœ¬æœå‹™ï¼ˆå¦‚æƒ¡æ„çˆ¬å–æ•¸æ“šï¼‰çš„è¡Œç‚ºã€‚",
                privacy_title: "éš±ç§æ”¿ç­–", privacy_content: "æœ¬éš±ç§æ”¿ç­–ï¼ˆæœ€å¾Œæ›´æ–°æ–¼2025å¹´8æœˆ17æ—¥ï¼‰æ—¨åœ¨èªªæ˜æˆ‘å€‘å¦‚ä½•æ”¶é›†ã€ä½¿ç”¨å’Œä¿è­·æ‚¨çš„ä¿¡æ¯ã€‚æˆ‘å€‘å°Šé‡æ‚¨çš„éš±ç§æ¬Šï¼Œä¸¦è‡´åŠ›æ–¼ä¿è­·æ‚¨çš„å€‹äººæ•¸æ“šã€‚æˆ‘å€‘é€šé Google Analytics æ”¶é›†åŒ¿åçš„ä½¿ç”¨æ•¸æ“šï¼ˆå¦‚é é¢ç€è¦½é‡ã€è¨­å‚™é¡å‹ï¼‰ï¼Œä»¥æ”¹å–„æœå‹™è³ªé‡ï¼Œé€™äº›æ•¸æ“šä¸åŒ…å«å€‹äººèº«ä»½ä¿¡æ¯ã€‚æˆ‘å€‘ä½¿ç”¨ç€è¦½å™¨çš„ LocalStorage æŠ€è¡“ä¾†ä¿å­˜æ‚¨çš„èªè¨€åå¥½å’Œæ”¶è—çš„é£Ÿè­œï¼Œé€™äº›ä¿¡æ¯åƒ…å­˜å„²åœ¨æ‚¨çš„è¨­å‚™ä¸Šï¼Œæˆ‘å€‘ç„¡æ³•è¨ªå•ã€‚æˆ‘å€‘ä½¿ç”¨ Google AdSense å±•ç¤ºå»£å‘Šï¼ŒGoogle å¯èƒ½æœƒæ ¹æ“šæ‚¨çš„ç€è¦½è¡Œç‚ºä½¿ç”¨ Cookie ä¾†æŠ•æ”¾å€‹æ€§åŒ–å»£å‘Šã€‚æ‚¨å¯ä»¥é€šé Google çš„å»£å‘Šè¨­ç½®ä¾†ç®¡ç†æ‚¨çš„å»£å‘Šåå¥½ã€‚æˆ‘å€‘æ‰¿è«¾ä¸æœƒå°‡æ‚¨çš„ä»»ä½•æ•¸æ“šå‡ºå”®æˆ–åˆ†äº«çµ¦ç¬¬ä¸‰æ–¹ã€‚è‹¥æ‚¨å°æœ¬æ”¿ç­–æœ‰ä»»ä½•ç–‘å•ï¼Œè«‹èˆ‡æˆ‘å€‘è¯ç¹«ã€‚",
                tip_storage_title: "ğŸ¥¬ é£Ÿæä¿å­˜", tip_storage_content: "ç»¿å¶è”¬èœç”¨æ¹¿çº¸å·¾åŒ…è£¹åæ”¾å…¥ä¿é²œè¢‹ï¼Œå¯å»¶é•¿3-5å¤©æ–°é²œåº¦", tip_seasoning_title: "ğŸ§‚ è°ƒå‘³æŠ€å·§", tip_seasoning_content: "ç‚’èœæ—¶ç›è¦åˆ†ä¸¤æ¬¡æ”¾ï¼šç‚’åˆ¶ä¸­æœŸå°‘è®¸ï¼Œèµ·é”…å‰è°ƒå‘³",
                install_hint_text: "é»æ“Šå³ä¸Šè§’åœ–æ¨™ï¼Œå³å¯å°‡æ‡‰ç”¨ç¨‹å¼ä¸‹è¼‰åˆ°æ‰‹æ©Ÿæ¡Œé¢ï¼",
                nutrition_knowledge_title: "ğŸŒŸ è¥å…»æ­é…å°çŸ¥è¯†", nutrition_combo1: "<strong>è›‹ç™½è´¨+ç»´ç”Ÿç´ Cï¼š</strong>ç‰›è‚‰é…ç•ªèŒ„ï¼Œä¿ƒè¿›é“è´¨å¸æ”¶", nutrition_combo2: "<strong>é’™è´¨+ç»´ç”Ÿç´ Dï¼š</strong>è±†è…é…é±¼ç±»ï¼Œå¼ºåŒ–éª¨éª¼å¥åº·", nutrition_combo3: "<strong>è†³é£Ÿçº¤ç»´ï¼š</strong>æ¯é¤è‡³å°‘ä¸€ç§ç»¿å¶è”¬èœï¼Œä¿ƒè¿›æ¶ˆåŒ–",
                healthy_eating_title: "ğŸ½ï¸ å¥åº·é¥®é£ŸæŒ‡å—", healthy_item1_name: "è”¬èœæ°´æœ", healthy_item1_desc: "æ¯æ—¥5ä»½", healthy_item2_name: "ä¼˜è´¨è›‹ç™½", healthy_item2_desc: "æ¯é¤1ä»½", healthy_item3_name: "å…¨è°·ç‰©", healthy_item3_desc: "æ›¿ä»£ç²¾åˆ¶è°·ç‰©",
                more_content_title: "ğŸ“š æ›´å¤šå†…å®¹", more_link1_title: "çƒ¹é¥ªæŠ€å·§å¤§å…¨", more_link1_desc: "ä¸“ä¸šå¨å¸ˆåˆ†äº«çš„å®ç”¨æŠ€å·§", more_link2_title: "è¥å…»æ­é…æŒ‡å—", more_link2_desc: "ç§‘å­¦çš„è¥å…»æ­é…åŸåˆ™", more_link3_title: "é£Ÿæä¿å­˜ç§˜ç±", more_link3_desc: "å»¶é•¿é£Ÿææ–°é²œåº¦çš„æ–¹æ³•", more_link4_title: "æ—¶ä»¤é£Ÿè°±æ¨è", more_link4_desc: "æ ¹æ®å­£èŠ‚æ¨èæœ€ä½³é£Ÿæ",
                back_to_home_button: "<i class=\"fas fa-arrow-left mr-2\"></i>è¿”å›é¦–é¡µ", cooking_skills_title: "ğŸ‘¨â€ğŸ³ çƒ¹é¥ªæŠ€å·§å¤§å…¨", heat_control_title: "ğŸ”¥ ç«å€™æ§åˆ¶æŠ€å·§", heat_control_li1: "<strong>å¤§ç«çˆ†ç‚’ï¼š</strong>é€‚åˆç»¿å¶è”¬èœï¼Œä¿æŒè„†å«©å£æ„Ÿå’Œé²œè‰³é¢œè‰²", heat_control_li2: "<strong>ä¸­ç«ç…ç‚¸ï¼š</strong>é±¼ç±»ã€è‚‰ç±»å¤–ç„¦å†…å«©çš„å…³é”®", heat_control_li3: "<strong>å°ç«æ…¢ç‚–ï¼š</strong>æ±¤å“ã€ç‚–èœå…¥å‘³çš„ç§˜è¯€", heat_control_li4: "<strong>ä½™æ¸©åˆ©ç”¨ï¼š</strong>å…³ç«åç”¨ä½™æ¸©ç„–ç…®ï¼ŒèŠ‚èƒ½åˆç¾å‘³", seasoning_ratio_title: "ğŸ§‚ è°ƒå‘³é»„é‡‘æ¯”ä¾‹", seasoning_ratio_li1: "<strong>ç³–é†‹æ¯”ä¾‹ï¼š</strong>ç³–1ï¼šé†‹2ï¼Œé…¸ç”œé€‚ä¸­", seasoning_ratio_li2: "<strong>è…Œåˆ¶è‚‰ç±»ï¼š</strong>ç›1%ï¼Œç³–0.5%ï¼Œæ–™é…’10%", seasoning_ratio_li3: "<strong>ç‚’èœç”¨ç›ï¼š</strong>500gèœå“ç”¨ç›3-5g", seasoning_ratio_li4: "<strong>æ±¤å“è°ƒå‘³ï¼š</strong>å…ˆæ·¡åæµ“ï¼Œé€æ­¥è°ƒæ•´",
                nutrition_guide_title: "ğŸ¥‘ è¥å…»æ­é…æŒ‡å—", rainbow_diet_title: "ğŸŒˆ å½©è™¹é¥®é£Ÿæ³•", rainbow_diet_desc: "æ¯å¤©æ‘„å…¥ä¸åŒé¢œè‰²çš„è”¬æœï¼Œç¡®ä¿è¥å…»ç´ çš„å…¨é¢æ€§ã€‚",
                storage_secrets_title: "ğŸ§Š é£Ÿæä¿å­˜ç§˜ç±", veggie_storage_title: "ğŸ¥¬ è”¬èœä¿å­˜æŠ€å·§", veggie_storage_desc: "ç§‘å­¦çš„ä¿å­˜æ–¹æ³•ï¼Œå»¶é•¿é£Ÿææ–°é²œåº¦ã€‚",
                seasonal_recipes_title: "ğŸŒ¸ æ—¶ä»¤é£Ÿè°±æ¨è", spring_recipes_title: "ğŸŒ¸ æ˜¥å­£æ—¶ä»¤", spring_recipes_desc: "æ ¹æ®å­£èŠ‚æ¨èæœ€ä½³é£Ÿæå’Œèœå“ã€‚"
            },
            en: { 
                lang_switcher: "ä¸­æ–‡", main_title: "InventaPlate", subtitle: "Enter ingredients for ideas, or search for a recipe directly!", input_placeholder: "e.g., egg, tomato", start_button: "Start", thinking: "Thinking...", generating_recipe: "Generating Recipe...", generating_image: "Creating Image...", art_director: "Hiring Art Director...", how_to_cook: "How would you like to cook it?", ai_creative_style: "AI Creative Style", image_ref_note: "Image for reference only", calories_label: "Est. Calories", calories_note: "(approx.)", ingredients_label: "Ingredients", instructions_label: "Instructions", error_title: "Oh no, an error occurred!", error_title_busy: "AI Chef is Busy!", error_busy_text: "Server is currently busy. Please try again later. Consider saving recipes you like to your favorites!", error_input_required: "Please enter ingredients or a recipe name!", error_generic: "Could not process your request. Please try again later.", error_recipe_gen: "Failed to generate recipe. Please try again later.", error_timeout: "Request timed out, server is responding slowly.", error_network: "Network connection issue, please check your internet connection.", step_label: "Step", pref_vegetarian: "Vegetarian", pref_low_calorie: "Low-Calorie", pref_spicy: "Spicy", welcome_title: "Welcome to InventaPlate!", welcome_text: "Stop wondering what to cook with the ingredients in your fridge. We use AI to create delicious recipes, turning your leftovers into a feast!", how_to_use_title: "How to Use?", step1_text: "Enter the ingredients you have in the search bar above (e.g., egg, tomato, onion).", step2_text: "Select your dietary preferences (e.g., Vegetarian, Spicy).", step3_text: "Click 'Start' and let us work our magic!", popular_searches_title: "Popular Searches", my_favorites: "My Favorites", favorites_title: "My Favorite Recipes", no_favorites_text: "You haven't saved any recipes yet. When you find a recipe you like, click the star icon to save it!", favorite_reminder: "Like this recipe? Tap the star to save it for offline access!", retry_text: "Retry", retrying_text: "Retrying...", back_home: "Back to Home", warm_reminder_title: "ğŸ’¡ Friendly Reminder", warm_reminder_text: "This site uses real AI to generate recipes, not traditional search functions. We strive to create unique culinary inspiration for you, but our AI servers may occasionally be busy. Please be patient with us. We recommend saving your favorite recipes for easy access anytime!", daily_tips_title: "ğŸ’¡ Daily Cooking Tips",
                footer_about: "About Us", footer_faq: "FAQ", footer_terms: "Terms of Service", footer_privacy: "Privacy Policy", footer_copyright: "Â© 2025 InventaPlate. All Rights Reserved.", close_button: "Close",
                about_title: "About InventaPlate", about_content: "InventaPlate was born from a simple idea: make cooking more fun, easier, and reduce food waste. We use advanced AI technology to transform the scattered ingredients in your fridge into surprisingly delicious meals. Whether you're a novice cook or an experienced chef, we hope to inspire your culinary creativity and turn every meal into a feast.",
                faq_title: "Frequently Asked Questions", faq_q1_title: "Q1: Is this service free?", faq_q1_content: "Yes, our core recipe generation feature is completely free. We sustain our operations through advertisements on the site and appreciate your support.", faq_q2_title: "Q2: Are the AI-generated recipes reliable?", faq_q2_content: "Our AI is trained on a vast amount of recipe data to provide creative and practical cooking suggestions. However, AI is not perfect, and we recommend you adjust the recipes based on your own taste and experience.", faq_q3_title: "Q3: Why does recipe generation sometimes fail?", faq_q3_content: "Since the AI server requires significant computing resources, it may become congested or slow to respond during peak hours (like dinner time). If this happens, please try again later or use our popular search suggestions.", faq_q4_title: "Q4: Can I save recipes I like?", faq_q4_content: "Absolutely! There is a star icon in the top-right corner of each recipe card. Click it to save the recipe to 'My Favorites' for easy access anytime, even offline.", faq_q5_title: "Q5: Are the images real photos?", faq_q5_content: "The recipe images are generated by AI based on the recipe's content to provide visual inspiration. They are for reference only. The actual dish may vary depending on ingredients and cooking techniques.",
                terms_title: "Terms of Service", terms_content: "Welcome to InventaPlate! By using this website, you agree to the following terms: All recipes and suggestions provided are for reference only. Users should judge their suitability and safety. We are not responsible for any direct or indirect loss resulting from the use of this site's content. We reserve the right to modify or terminate the service at any time without notice. Any misuse of the service (e.g., malicious data scraping) is prohibited.",
                privacy_title: "Privacy Policy", privacy_content: "This Privacy Policy (last updated August 17, 2025) explains how we collect, use, and protect your information. We respect your privacy and are committed to protecting your personal data. We collect anonymous usage data (e.g., page views, device type) through Google Analytics to improve our service; this data does not contain personally identifiable information. We use your browser's LocalStorage to save your language preferences and favorite recipes, which are stored only on your device and are inaccessible to us. We use Google AdSense for advertising, and Google may use cookies to serve personalized ads based on your browsing behavior. You can manage your ad preferences through Google's Ad Settings. We will not sell or share your data with third parties. If you have any questions about this policy, please contact us.",
                tip_storage_title: "ğŸ¥¬ Ingredient Storage", tip_storage_content: "Wrap leafy greens in a damp paper towel and place them in a plastic bag to extend freshness by 3-5 days.", tip_seasoning_title: "ğŸ§‚ Seasoning Tips", tip_seasoning_content: "When stir-frying, add salt in two stages: a little during the middle of cooking, and the rest to taste just before serving.",
                install_hint_text: "Tap the icon in the top right to add the app to your home screen!",
                nutrition_knowledge_title: "ğŸŒŸ Nutrition Pairing Knowledge", nutrition_combo1: "<strong>Protein + Vitamin C:</strong> Beef with tomatoes enhances iron absorption", nutrition_combo2: "<strong>Calcium + Vitamin D:</strong> Tofu with fish strengthens bone health", nutrition_combo3: "<strong>Dietary Fiber:</strong> At least one leafy green per meal to aid digestion",
                healthy_eating_title: "ğŸ½ï¸ Healthy Eating Guide", healthy_item1_name: "Fruits & Veggies", healthy_item1_desc: "5 servings daily", healthy_item2_name: "Quality Protein", healthy_item2_desc: "1 serving per meal", healthy_item3_name: "Whole Grains", healthy_item3_desc: "Replace refined grains",
                more_content_title: "ğŸ“š More Content", more_link1_title: "Cooking Skills Guide", more_link1_desc: "Practical tips from professional chefs", more_link2_title: "Nutrition Pairing Guide", more_link2_desc: "Principles of scientific nutrition pairing", more_link3_title: "Ingredient Storage Secrets", more_link3_desc: "Methods to extend ingredient freshness", more_link4_title: "Seasonal Recipe Picks", more_link4_desc: "Best ingredients based on the season",
                back_to_home_button: "<i class=\"fas fa-arrow-left mr-2\"></i>Back to Home", cooking_skills_title: "ğŸ‘¨â€ğŸ³ Cooking Skills Guide", heat_control_title: "ğŸ”¥ Heat Control Techniques", heat_control_li1: "<strong>High Heat Stir-fry:</strong> Ideal for leafy greens to keep them crisp and vibrant.", heat_control_li2: "<strong>Medium Heat Pan-fry:</strong> Key to a crispy outside and tender inside for fish and meat.", heat_control_li3: "<strong>Low Heat Simmer:</strong> The secret to flavorful soups and stews.", heat_control_li4: "<strong>Residual Heat:</strong> Use residual heat to finish cooking, saving energy and adding flavor.", seasoning_ratio_title: "ğŸ§‚ Golden Seasoning Ratios", seasoning_ratio_li1: "<strong>Sweet & Sour:</strong> 1 part sugar to 2 parts vinegar for a balanced taste.", seasoning_ratio_li2: "<strong>Meat Marinade:</strong> 1% salt, 0.5% sugar, 10% cooking wine.", seasoning_ratio_li3: "<strong>Stir-fry Salt:</strong> 3-5g of salt for every 500g of ingredients.", seasoning_ratio_li4: "<strong>Soup Seasoning:</strong> Start light and adjust gradually.",
                nutrition_guide_title: "ğŸ¥‘ Nutrition Pairing Guide", rainbow_diet_title: "ğŸŒˆ Rainbow Diet", rainbow_diet_desc: "Eat fruits and vegetables of different colors every day to ensure a full range of nutrients.",
                storage_secrets_title: "ğŸ§Š Ingredient Storage Secrets", veggie_storage_title: "ğŸ¥¬ Vegetable Storage Tips", veggie_storage_desc: "Scientific preservation methods to extend the freshness of ingredients.",
                seasonal_recipes_title: "ğŸŒ¸ Seasonal Recipe Picks", spring_recipes_title: "ğŸŒ¸ Spring Season", spring_recipes_desc: "Recommending the best ingredients and dishes according to the season."
            }
        };
        
        // --- The rest of your complete JavaScript code ---
        // I am including the full JS code from your file to ensure everything is here.
        let currentLanguage = localStorage.getItem('inventaPlateLang') || 'zh';
        
        class RecipeCache {
            constructor() { this.cache = new Map(); this.maxSize = 50; this.preloadPopularRecipes(); }
            set(key, value) { if (this.cache.size >= this.maxSize) { const firstKey = this.cache.keys().next().value; this.cache.delete(firstKey); } this.cache.set(key, { data: value, timestamp: Date.now(), hits: 0 }); try { localStorage.setItem('recipeCache', JSON.stringify(Array.from(this.cache.entries()))); } catch (e) { console.log('ç¼“å­˜ä¿å­˜å¤±è´¥'); } }
            get(key) { const item = this.cache.get(key); if (item) { item.hits++; item.lastAccessed = Date.now(); return item.data; } return null; }
            has(key) { return this.cache.has(key); }
            findSimilar(searchTerm) { const searchLower = searchTerm.toLowerCase(); for (const [key, value] of this.cache.entries()) { if (key.toLowerCase().includes(searchLower) || searchLower.includes(key.toLowerCase())) { value.hits++; return { key, data: value.data, similarity: 'similar' }; } } return null; }
            async preloadPopularRecipes() { const popularIngredients = ['é›è›‹', 'é¸¡è‚‰', 'ç•ªèŒ„', 'é©¬é“ƒè–¯', 'æ´‹è‘±', 'é’èœ', 'çŒªè‚‰', 'é±¼', 'è±†è…', 'é¢æ¡']; try { const saved = localStorage.getItem('recipeCache'); if (saved) { this.cache = new Map(JSON.parse(saved)); console.log('å·²æ¢å¤ç¼“å­˜:', this.cache.size, 'ä¸ªé£Ÿè°±'); return; } } catch (e) { console.log('ç¼“å­˜æ¢å¤å¤±è´¥'); } console.log('å¼€å§‹é¢„åŠ è½½çƒ­é—¨é£Ÿè°±...'); for (const ingredient of popularIngredients.slice(0, 5)) { if (!this.has(ingredient)) { try { this.set(ingredient, this.generateStaticRecipe(ingredient)); await new Promise(resolve => setTimeout(resolve, 100)); } catch (error) { console.log(`é¢„åŠ è½½ ${ingredient} å¤±è´¥:`, error); } } } }
            generateStaticRecipe(ingredient) { const recipes = { 'é›è›‹': { recipeName: 'ç»å…¸ç‚’é¸¡è›‹', calories: 155, ingredients: [{ name: 'é¸¡è›‹', quantity: '3ä¸ª' }, { name: 'ç›', quantity: 'å°‘è®¸' }, { name: 'é£Ÿç”¨æ²¹', quantity: '1æ±¤åŒ™' }, { name: 'è‘±èŠ±', quantity: 'é€‚é‡' }], instructions: ['å°†é¸¡è›‹æ‰“æ•£ï¼ŒåŠ å…¥å°‘è®¸ç›è°ƒå‘³', 'çƒ­é”…ä¸‹æ²¹ï¼Œå€’å…¥è›‹æ¶²', 'å¿«é€Ÿç‚’åˆ¶è‡³åŠç†ŸçŠ¶æ€', 'æ’’ä¸Šè‘±èŠ±ï¼Œç»§ç»­ç‚’è‡³å…¨ç†Ÿå³å¯'] }, 'é¸¡è‚‰': { recipeName: 'å«©æ»‘é¸¡è‚‰ä¸', calories: 240, ingredients: [{ name: 'é¸¡èƒ¸è‚‰', quantity: '200å…‹' }, { name: 'ç”ŸæŠ½', quantity: '1æ±¤åŒ™' }, { name: 'æ–™é…’', quantity: '1èŒ¶åŒ™' }, { name: 'æ·€ç²‰', quantity: '1èŒ¶åŒ™' }], instructions: ['é¸¡è‚‰åˆ‡ä¸ï¼Œç”¨ç”ŸæŠ½ã€æ–™é…’ã€æ·€ç²‰è…Œåˆ¶15åˆ†é’Ÿ', 'çƒ­é”…ä¸‹æ²¹ï¼Œä¸‹é¸¡è‚‰ä¸ç‚’è‡³å˜è‰²', 'åŠ å…¥è°ƒæ–™ç‚’åŒ€', 'è£…ç›˜å³å¯äº«ç”¨'] }, 'ç•ªèŒ„': { recipeName: 'ç•ªèŒ„é¸¡è›‹', calories: 180, ingredients: [{ name: 'ç•ªèŒ„', quantity: '2ä¸ª' }, { name: 'é¸¡è›‹', quantity: '3ä¸ª' }, { name: 'ç³–', quantity: '1èŒ¶åŒ™' }, { name: 'ç›', quantity: 'é€‚é‡' }], instructions: ['ç•ªèŒ„å»çš®åˆ‡å—ï¼Œé¸¡è›‹æ‰“æ•£', 'å…ˆç‚’é¸¡è›‹ç››èµ·', 'ç‚’ç•ªèŒ„å‡ºæ±ï¼ŒåŠ ç³–å’Œç›', 'å€’å…¥é¸¡è›‹ç‚’åŒ€å³å¯'] } }; return recipes[ingredient] || { recipeName: `${ingredient}ç®€æ˜“æ–™ç†`, calories: 200, ingredients: [{ name: ingredient, quantity: 'é€‚é‡' }, { name: 'ç›', quantity: 'å°‘è®¸' }, { name: 'æ²¹', quantity: 'é€‚é‡' }], instructions: [`å°†${ingredient}æ¸…æ´—å¹²å‡€`, 'æ ¹æ®ä¸ªäººå–œå¥½è¿›è¡Œè°ƒå‘³', 'ç”¨é€‚å½“çš„çƒ¹é¥ªæ–¹æ³•åˆ¶ä½œ', 'è£…ç›˜å³å¯äº«ç”¨'] }; }
            getStats() { const stats = { totalItems: this.cache.size, mostPopular: null, oldestItem: null }; let maxHits = 0; let oldestTime = Date.now(); for (const [key, value] of this.cache.entries()) { if (value.hits > maxHits) { maxHits = value.hits; stats.mostPopular = key; } if (value.timestamp < oldestTime) { oldestTime = value.timestamp; stats.oldestItem = key; } } return stats; }
        }
        const recipeCache = new RecipeCache();
        const expertRecipes = { 'æ“‚èŒ¶': { zh: { recipeName: "æ­£å®—å®¢å®¶æ“‚èŒ¶", calories: 450, ingredients: [{ name: "ç¶ èŒ¶è‘‰", quantity: "1æ¹¯åŒ™" }, { name: "çƒ¤èŠ±ç”Ÿ", quantity: "50å…‹" }, { name: "çƒ¤èŠéº»", quantity: "2æ¹¯åŒ™" }, { name: "è–„è·è‘‰", quantity: "1å°æŠŠ" }, { name: "ä¹å±¤å¡” (é‡‘ä¸æ›)", quantity: "1å°æŠŠ" }, { name: "é•·è±†", quantity: "100å…‹ (åˆ‡ç²’)" }, { name: "èœè„¯ (ç”œ)", quantity: "3æ¹¯åŒ™ (åˆ‡ç¢)" }, { name: "è±†è…ä¹¾", quantity: "2å¡Š (åˆ‡ä¸)" }, { name: "è¦ç±³", quantity: "1æ¹¯åŒ™ (å¯é¸)" }, { name: "æ¨¹ä»”èœ", quantity: "1æŠŠ" }, { name: "ç™½é£¯", quantity: "2ç¢—" }], instructions: ["æ“‚èŒ¶é†¬ï¼šå°‡ç¶ èŒ¶è‘‰ã€çƒ¤èŠ±ç”Ÿã€çƒ¤èŠéº»ã€è–„è·è‘‰å’Œä¹å±¤å¡”æ”¾å…¥æ“‚ç¼½ä¸­ï¼Œç”¨æ“‚æ£æ…¢æ…¢ç ”ç£¨æˆå¹¼æ»‘çš„ç³Šç‹€ã€‚", "æº–å‚™é…æ–™ï¼šåˆ†åˆ¥å°‡é•·è±†ã€è±†è…ä¹¾ç‚’ç†Ÿã€‚èœè„¯å’Œè¦ç±³ï¼ˆå¦‚æœä½¿ç”¨ï¼‰ä¹Ÿç¨å¾®çˆ†é¦™å‚™ç”¨ã€‚", "æ²–æ³¡èŒ¶æ¹¯ï¼šå°‡ç ”ç£¨å¥½çš„æ“‚èŒ¶é†¬å–å‡ºï¼ŒåŠ å…¥æ»¾æ°´æ”ªæ‹Œå‡å‹»ï¼Œä¾å€‹äººå–œå¥½ç”¨é¹½èª¿å‘³ã€‚", "çµ„åˆï¼šåœ¨ç¢—ä¸­ç››å…¥ç™½é£¯ï¼Œé‹ªä¸Šæ‰€æœ‰æº–å‚™å¥½çš„é…æ–™ã€‚", "äº«ç”¨ï¼šå°‡æº«ç†±çš„æ“‚èŒ¶æ¹¯æ·‹åœ¨é£¯ä¸Šï¼Œæ”ªæ‹Œå‡å‹»å³å¯äº«ç”¨ã€‚"] }, en: { recipeName: "Authentic Hakka Lei Cha", calories: 450, ingredients: [{ name: "Green Tea Leaves", quantity: "1 tbsp" }, { name: "Roasted Peanuts", quantity: "50g" }, { name: "Toasted Sesame Seeds", quantity: "2 tbsp" }, { name: "Mint Leaves", quantity: "1 small handful" }, { name: "Basil Leaves", quantity: "1 small handful" }, { name: "Long Beans", quantity: "100g (diced)" }, { name: "Preserved Radish (sweet)", quantity: "3 tbsp (minced)" }, { name: "Firm Tofu", quantity: "2 blocks (diced)" }, { name: "Dried Shrimp", quantity: "1 tbsp (optional)" }, { name: "Mani Cai", quantity: "1 bunch" }, { name: "Cooked Rice", quantity: "2 bowls" }], instructions: ["Make the tea paste: In a traditional grooved bowl, grind the green tea leaves, roasted peanuts, sesame seeds, mint, and basil into a smooth paste.", "Prepare toppings: SautÃ© the long beans and diced tofu separately. Briefly stir-fry the preserved radish and dried shrimp (if using).", "Make the tea soup: Take the ground tea paste and whisk it with hot water until well combined. Season with salt to your liking.", "Assemble: Place cooked rice in a bowl and arrange all the prepared toppings over it.", "Serve: Pour the warm tea soup over the rice and toppings. Mix well and enjoy."] } } };
        const mainInput = document.getElementById('main-input');
        const startBtn = document.getElementById('start-btn');
        const resultContainer = document.getElementById('result-container');
        const langSwitcherBtn = document.getElementById('lang-switcher');
        const myFavoritesBtn = document.getElementById('my-favorites-btn');
        const preferencesContainer = document.getElementById('preferences-container');
        const initialContentContainer = document.getElementById('initial-content-container');
        const templates = { initialContent: document.getElementById('initial-content-template'), favoritesView: document.getElementById('favorites-view-template'), recipeCard: document.getElementById('recipe-card-template'), error: document.getElementById('error-message-template'), };
        function getFavorites() { try { return JSON.parse(localStorage.getItem('inventaPlateFavorites') || '[]'); } catch (e) { console.error('è®€å–æ”¶è—å¤±æ•—:', e); return []; } }
        function saveFavorites(favorites) { try { localStorage.setItem('inventaPlateFavorites', JSON.stringify(favorites)); return true; } catch (e) { console.error('ä¿å­˜æ”¶è—å¤±æ•—:', e); return false; } }
        function isFavorite(recipeName) { return getFavorites().some(fav => fav.recipeName === recipeName); }
        function toggleFavorite(recipeData, imageUrl) { let favorites = getFavorites(); const recipeName = recipeData.recipeName; const existingIndex = favorites.findIndex(fav => fav.recipeName === recipeName); if (existingIndex > -1) { favorites.splice(existingIndex, 1); console.log('å¾æ”¶è—ä¸­ç§»é™¤:', recipeName); } else { favorites.push({ ...recipeData, imageUrl, savedAt: new Date().toISOString() }); console.log('æ·»åŠ åˆ°æ”¶è—:', recipeName); } const saved = saveFavorites(favorites); if (!saved) { alert(currentLanguage === 'zh' ? 'æ”¶è—åŠŸèƒ½æš«æ™‚ç„¡æ³•ä½¿ç”¨' : 'Favorites feature temporarily unavailable'); return existingIndex === -1; } return existingIndex === -1; }
        function showFavorites() { initialContentContainer.style.display = 'none'; resultContainer.innerHTML = ''; const favorites = getFavorites(); const favoritesView = templates.favoritesView.content.cloneNode(true); resultContainer.appendChild(favoritesView); const noFavsText = resultContainer.querySelector('#no-favorites-text'); if (favorites.length === 0) { noFavsText.style.display = 'block'; } else { noFavsText.style.display = 'none'; favorites.forEach(fav => { displayRecipe(fav, fav.imageUrl, true); }); } setLanguage(currentLanguage); }
        function setLanguage(lang) { currentLanguage = lang; localStorage.setItem('inventaPlateLang', lang); document.documentElement.lang = lang; document.querySelectorAll('[data-translate]').forEach(el => { const key = el.getAttribute('data-translate'); if (translations[lang][key]) { el.innerHTML = translations[lang][key]; } }); langSwitcherBtn.textContent = translations[lang].lang_switcher; mainInput.placeholder = translations[lang].input_placeholder; }
        function getSelectedPreferences() { return Array.from(preferencesContainer.querySelectorAll('.preference-btn.active')).map(btn => btn.dataset.preference); }
        function showLoadingStates() { const loadingStates = [translations[currentLanguage].thinking, translations[currentLanguage].generating_recipe, translations[currentLanguage].art_director, translations[currentLanguage].generating_image]; let currentStateIndex = 0; const updateLoadingText = () => { const span = startBtn.querySelector('span'); if (span && startBtn.disabled) { span.textContent = loadingStates[currentStateIndex % loadingStates.length]; currentStateIndex++; } }; updateLoadingText(); const interval = setInterval(() => { if (!startBtn.disabled) { clearInterval(interval); return; } updateLoadingText(); }, 3000); return interval; }
        async function makeApiCallWithRetry(targetApi, payload, maxRetries = 3) { let lastError = null; for (let attempt = 1; attempt <= maxRetries; attempt++) { try { console.log(`APIèª¿ç”¨å˜—è©¦ ${attempt}/${maxRetries}`); const controller = new AbortController(); const timeoutId = setTimeout(() => controller.abort(), 30000); const response = await fetch('/api/generate', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ targetApi: targetApi, payload: payload }), signal: controller.signal }); clearTimeout(timeoutId); if (!response.ok) { const errorText = await response.text(); console.error(`APIéŸ¿æ‡‰éŒ¯èª¤ ${response.status}:`, errorText); if (response.status === 503 || response.status === 429) { throw new Error(`SERVER_BUSY_${response.status}`); } else if (response.status >= 500) { throw new Error(`SERVER_ERROR_${response.status}`); } else { throw new Error(`API_ERROR_${response.status}`); } } const result = await response.json(); console.log(`APIèª¿ç”¨æˆåŠŸï¼Œå˜—è©¦ ${attempt}`); return result; } catch (error) { console.error(`APIèª¿ç”¨å˜—è©¦ ${attempt} å¤±æ•—:`, error); lastError = error; if (error.name === 'AbortError') { lastError = new Error('TIMEOUT_ERROR'); } if (attempt < maxRetries) { const waitTime = Math.min(2000 * Math.pow(2, attempt - 1), 10000); console.log(`ç­‰å¾… ${waitTime}ms å¾Œé‡è©¦...`); await new Promise(resolve => setTimeout(resolve, waitTime)); } } } console.error('æ‰€æœ‰é‡è©¦éƒ½å¤±æ•—äº†'); throw lastError; }
        function getErrorMessage(error) { const errorStr = error.toString(); console.log('éŒ¯èª¤é¡å‹:', errorStr); if (errorStr.includes('SERVER_BUSY') || errorStr.includes('503')) { return { title: translations[currentLanguage].error_title_busy, message: translations[currentLanguage].error_busy_text, isBusy: true }; } else if (errorStr.includes('TIMEOUT')) { return { title: translations[currentLanguage].error_title_busy, message: translations[currentLanguage].error_timeout, isBusy: true }; } else if (errorStr.includes('NetworkError') || errorStr.includes('fetch')) { return { title: translations[currentLanguage].error_title, message: translations[currentLanguage].error_network, isBusy: false }; } else { return { title: translations[currentLanguage].error_title, message: error.message || translations[currentLanguage].error_generic, isBusy: false }; } }
        function displayError(message, isBusy = false, customTitle = null) { resultContainer.innerHTML = ''; const errorCard = templates.error.content.cloneNode(true); const titleElement = errorCard.querySelector('.error-title'); const textElement = errorCard.querySelector('.error-text'); const retryBtn = errorCard.querySelector('.retry-btn'); const retryText = errorCard.querySelector('.retry-text'); const backBtn = errorCard.querySelector('.back-home-btn'); if (customTitle) { titleElement.textContent = customTitle; } else if (isBusy) { titleElement.textContent = translations[currentLanguage].error_title_busy; } else { titleElement.textContent = translations[currentLanguage].error_title; } textElement.textContent = message; retryText.textContent = translations[currentLanguage].retry_text; retryBtn.addEventListener('click', () => { const lastInput = mainInput.value.trim(); if (lastInput) { retryText.innerHTML = `<div class="loading-spinner"></div>${translations[currentLanguage].retrying_text}`; retryBtn.disabled = true; setTimeout(() => { handleInitialInput(lastInput); }, 1000); } }); backBtn.addEventListener('click', () => { showInitialContent(); }); resultContainer.appendChild(errorCard); }
        function setLoading(isLoading, message) { startBtn.disabled = isLoading; const span = startBtn.querySelector('span'); const icon = startBtn.querySelector('i'); if (isLoading) { if (span) span.innerHTML = `<div class="loading-spinner"></div>${message}`; if (icon) icon.style.display = 'none'; showLoadingStates(); } else { if (span) span.textContent = translations[currentLanguage].start_button; if (icon) { icon.style.display = 'inline'; icon.className = 'fas fa-search mr-2'; } } if (isLoading && message === translations[currentLanguage].thinking) { resultContainer.innerHTML = ''; } }
        async function checkCacheFirst(userInput) { const inputLower = userInput.toLowerCase(); if (recipeCache.has(inputLower)) { return { data: recipeCache.get(inputLower), source: 'exact', imageUrl: 'https://placehold.co/600x400/10B981/FFFFFF?text=Cached+Recipe' }; } const similarResult = recipeCache.findSimilar(inputLower); if (similarResult) { return { data: similarResult.data, source: 'similar', imageUrl: 'https://placehold.co/600x400/F59E0B/FFFFFF?text=Similar+Recipe' }; } const popularIngredients = ['é›è›‹', 'é¸¡è‚‰', 'ç•ªèŒ„', 'é©¬é“ƒè–¯', 'æ´‹è‘±']; for (const ingredient of popularIngredients) { if (inputLower.includes(ingredient) && recipeCache.has(ingredient)) { return { data: recipeCache.get(ingredient), source: 'ingredient_match', imageUrl: 'https://placehold.co/600x400/8B5CF6/FFFFFF?text=Ingredient+Match' }; } } return null; }
        async function getFallbackFromCache(userInput) { const cache = recipeCache.cache; if (cache.size > 0) { let mostPopular = null; let maxHits = 0; for (const [key, value] of cache.entries()) { if (value.hits > maxHits) { maxHits = value.hits; mostPopular = value.data; } } if (mostPopular) { return { data: mostPopular, source: 'fallback', imageUrl: 'https://placehold.co/600x400/EF4444/FFFFFF?text=Popular+Recipe' }; } } return null; }
        async function handleInitialInput(userInput) { const trimmedInput = userInput.trim(); if (!trimmedInput) { displayError(translations[currentLanguage].error_input_required); return; } initialContentContainer.style.display = 'none'; resultContainer.innerHTML = ''; const cacheResult = await checkCacheFirst(trimmedInput); if (cacheResult) { console.log('ä½¿ç”¨ç¼“å­˜ç»“æœ:', cacheResult.source); displayRecipe(cacheResult.data, cacheResult.imageUrl || 'https://placehold.co/600x400/10B981/FFFFFF?text=Cached+Recipe', false); if (cacheResult.source === 'similar') { showToast('ä¸ºæ‚¨æ¨èç›¸ä¼¼é£Ÿè°± ğŸ”¥'); } return; } setLoading(true, translations[currentLanguage].thinking); try { const expertRecipeKey = Object.keys(expertRecipes).find(key => trimmedInput.includes(key)); if (expertRecipeKey) { const recipeData = expertRecipes[expertRecipeKey][currentLanguage]; await generateFinalRecipe(null, recipeData.recipeName, [], recipeData); return; } const preferences = getSelectedPreferences(); const inputType = await determineInputType(trimmedInput); if (inputType === 'recipe_name') { await generateFinalRecipe(trimmedInput, trimmedInput, preferences); } else { const styles = await getCookingStyles(trimmedInput, preferences); displayCookingStyles(styles, trimmedInput, preferences); } } catch (error) { console.error("ä¸»è¦æµç¨‹éŒ¯èª¤:", error); const fallbackResult = await getFallbackFromCache(trimmedInput); if (fallbackResult) { displayRecipe(fallbackResult.data, fallbackResult.imageUrl || 'https://placehold.co/600x400/10B981/FFFFFF?text=Fallback+Recipe', false); showToast('æœåŠ¡ç¹å¿™ï¼Œä¸ºæ‚¨æ¨èç›¸å…³é£Ÿè°± ğŸ’«'); } else { const errorInfo = getErrorMessage(error); displayError(errorInfo.message, errorInfo.isBusy, errorInfo.title); } setLoading(false); } }
        async function generateFinalRecipe(style, ingredients, preferences, preloadedRecipe = null) { try { let recipeData; if (preloadedRecipe) { recipeData = preloadedRecipe; } else { setLoading(true, translations[currentLanguage].generating_recipe); recipeData = await generateRecipe(style, ingredients, preferences); if (!recipeData) throw new Error(translations[currentLanguage].error_recipe_gen); const cacheKey = (style || ingredients).toLowerCase(); recipeCache.set(cacheKey, recipeData); } setLoading(true, translations[currentLanguage].art_director); const imagePromptIngredients = preloadedRecipe ? recipeData.recipeName : ingredients; const imageUrl = await generateImageWithArtDirector(recipeData, imagePromptIngredients); resultContainer.innerHTML = ''; displayRecipe(recipeData, imageUrl, false); } catch (error) { console.error("ç”Ÿæˆé£Ÿè­œéŒ¯èª¤:", error); const fallbackResult = await getFallbackFromCache(ingredients); if (fallbackResult) { displayRecipe(fallbackResult.data, fallbackResult.imageUrl, false); showToast('AIç¹å¿™ä¸­ï¼Œä¸ºæ‚¨æ¨èçƒ­é—¨é£Ÿè°± ğŸŒŸ'); } else { const errorInfo = getErrorMessage(error); displayError(errorInfo.message, errorInfo.isBusy, errorInfo.title); } } finally { setLoading(false); } }
        async function determineInputType(userInput) { const prompt = `Analyze the following text and determine if it's a 'list of ingredients' or a 'recipe name'. Text: "${userInput}". Respond with only "ingredients" or "recipe_name".`; const payload = { contents: [{ parts: [{ text: prompt }] }] }; const result = await makeApiCallWithRetry('gemini', payload); const text = result?.candidates?.[0]?.content?.parts?.[0]?.text?.trim().replace(/"/g, ''); if (text === 'ingredients' || text === 'recipe_name') return text; return userInput.includes(',') || userInput.split(' ').length > 2 ? 'ingredients' : 'recipe_name'; }
        async function getCookingStyles(ingredients, preferences) { const langInstruction = currentLanguage === 'en' ? 'English' : 'Chinese'; const preferenceText = preferences.length > 0 ? ` considering these preferences: ${preferences.join(', ')}` : ''; const prompt = `In JSON array format, list the 4 most popular classic dish names for '${ingredients}' in the Malaysia/Singapore region${preferenceText}. Respond in ${langInstruction}. Example: ["Style A", "Style B"]`; const payload = { contents: [{ parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json" } }; const result = await makeApiCallWithRetry('gemini', payload); const text = result?.candidates?.[0]?.content?.parts?.[0]?.text; let styles = []; try { styles = JSON.parse(text); if (!Array.isArray(styles)) styles = []; } catch { styles = []; } styles.push(translations[currentLanguage].ai_creative_style); return styles; }
        async function generateRecipe(style, ingredients, preferences) { const langInstruction = currentLanguage === 'en' ? 'Respond in English.' : 'è«‹ç”¨ä¸­æ–‡å›ç­”ã€‚'; const preferenceText = preferences.length > 0 ? `\n3. CRITICAL: The recipe MUST strictly adhere to the following dietary preferences: ${preferences.join(', ')}.` : ''; const baseRule = `\n\n**Rules:**\n1. Steps must be logical for a home cook.\n2. Quantities must be reasonable.${preferenceText}\nPlease respond STRICTLY in the following JSON format:\n- recipeName (string), description (string), calories (number), ingredients (array of {name, quantity}), instructions (array of strings).\n${langInstruction}`; let prompt; if (style === translations[currentLanguage].ai_creative_style) { prompt = `You are an experienced home cook. Design a delicious, logical recipe based on these ingredients: ${ingredients}. Create a suitable name for it.` + baseRule; } else { prompt = `You are a professional chef. Provide a detailed, authentic recipe for '${style}'. Main ingredients are '${ingredients}'. The recipe name must be '${style}'.` + baseRule; } const payload = { contents: [{ parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json", responseSchema: { type: "OBJECT", properties: { recipeName: { type: "STRING" }, description: { type: "STRING" }, calories: { type: "NUMBER" }, ingredients: { type: "ARRAY", items: { type: "OBJECT", properties: { name: { type: "STRING" }, quantity: { type: "STRING" } }, required: ["name", "quantity"] } }, instructions: { type: "ARRAY", items: { type: "STRING" } } }, required: ["recipeName", "description", "calories", "ingredients", "instructions"] } } }; const result = await makeApiCallWithRetry('gemini', payload); const text = result?.candidates?.[0]?.content?.parts?.[0]?.text; if (text) { try { return JSON.parse(text); } catch(e) { console.error("è§£æé£Ÿè­œJSONå¤±æ•—:", text, e); throw new Error("AIè¿”å›äº†ç„¡æ•ˆçš„é£Ÿè­œæ ¼å¼ã€‚"); } } return null; }
        async function generateImageWithArtDirector(recipeData, originalIngredients) { const artDirectorPrompt = await createVisualPrompt(recipeData.recipeName, originalIngredients); if (!artDirectorPrompt) { console.warn("Art Directorå¤±æ•—ï¼Œä½¿ç”¨åŸºæœ¬åœ–ç‰‡ç”Ÿæˆã€‚"); const fallbackPrompt = `Professional food photography of a dish named '${recipeData.recipeName}' with main ingredients '${originalIngredients}'.`; return await generateImage(fallbackPrompt); } setLoading(true, translations[currentLanguage].generating_image); return await generateImage(artDirectorPrompt); }
        async function createVisualPrompt(recipeName, ingredients) { const prompt = `Act as a professional food stylist. I will give you a dish name. Your task is to write a single, detailed paragraph in English for an AI image generator. This description should be a visually rich "prompt" that describes the dish's appearance, plating, texture, and common garnishes. Be specific about the cultural context (e.g., Japanese, Thai, Chinese).\n\nDish Name: "${recipeName}"\nMain Ingredients: "${ingredients}"\n\nProvide the detailed English visual description now.`; const payload = { contents: [{ parts: [{ text: prompt }] }] }; const result = await makeApiCallWithRetry('gemini', payload); return result?.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || null; }
        async function generateImage(prompt) { const payload = { instances: [{ prompt: prompt }], parameters: { "sampleCount": 1 } }; const result = await makeApiCallWithRetry('imagen', payload); const base64Data = result?.predictions?.[0]?.bytesBase64Encoded; if (base64Data) { return `data:image/png;base64,${base64Data}`; } return `https://placehold.co/600x400/CCCCCC/FFFFFF?text=Image+Generation+Failed`; }
        function showInitialContent() { resultContainer.innerHTML = ''; const content = templates.initialContent.content.cloneNode(true); initialContentContainer.innerHTML = ''; initialContentContainer.appendChild(content); initialContentContainer.style.display = 'block'; const popSearchContainer = initialContentContainer.querySelector('#popular-searches-container'); if(popSearchContainer) { popSearchContainer.addEventListener('click', (event) => { if (event.target.matches('.popular-search-btn')) { const searchTerm = event.target.getAttribute('data-search'); mainInput.value = searchTerm; handleInitialInput(searchTerm); } }); } setLanguage(currentLanguage); }
        function displayCookingStyles(styles, ingredients, preferences) { resultContainer.innerHTML = ''; const styleCard = document.createElement('div'); styleCard.className = 'bg-white p-6 rounded-xl shadow-md'; styleCard.innerHTML = `<h2 class="text-2xl font-bold text-gray-800 mb-6 text-center" data-translate="how_to_cook">${translations[currentLanguage].how_to_cook}</h2><div id="style-buttons-container" class="space-y-4"></div>`; const container = styleCard.querySelector('#style-buttons-container'); styles.forEach(style => { const button = document.createElement('button'); button.textContent = style; button.className = 'style-btn w-full bg-white p-4 rounded-lg shadow border-2 border-gray-200 hover:border-green-500 hover:text-green-600 font-semibold transition-all'; if (style === translations['zh'].ai_creative_style || style === translations['en'].ai_creative_style) { button.classList.add('bg-green-100', 'text-green-700'); } button.onclick = () => { resultContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-md"><div class="bg-gray-200 h-64 w-full rounded-lg animate-pulse"></div><div class="h-8 bg-gray-200 rounded w-3/4 mt-6 animate-pulse"></div></div>`; generateFinalRecipe(style, ingredients, preferences); }; container.appendChild(button); }); resultContainer.appendChild(styleCard); setLoading(false); }
        function displayRecipe(data, imageUrl, isFavoriteView = false) { const cardFragment = templates.recipeCard.content.cloneNode(true); const card = cardFragment.firstElementChild; card.querySelector('.recipe-image').src = imageUrl; card.querySelector('.recipe-image').alt = `Image of ${data.recipeName}`; card.querySelector('.recipe-name').textContent = data.recipeName; card.querySelector('.recipe-calories').textContent = data.calories; const ingredientsList = card.querySelector('.recipe-ingredients'); ingredientsList.innerHTML = ''; data.ingredients.forEach(item => { const li = document.createElement('li'); li.textContent = `${item.name} - ${item.quantity}`; ingredientsList.appendChild(li); }); const instructionsDiv = card.querySelector('.recipe-instructions'); instructionsDiv.innerHTML = ''; data.instructions.forEach((step, index) => { const p = document.createElement('p'); p.innerHTML = `<strong class="text-green-600">${translations[currentLanguage].step_label} ${index + 1}:</strong> ${step}`; instructionsDiv.appendChild(p); }); const favBtn = card.querySelector('.favorite-btn'); const favReminder = card.querySelector('.favorite-reminder'); function updateFavButtonState() { const icon = favBtn.querySelector('i'); if (isFavorite(data.recipeName)) { favBtn.classList.add('saved'); icon.className = 'fas fa-star'; favBtn.title = currentLanguage === 'zh' ? "å¾æˆ‘çš„æœ€æ„›ä¸­ç§»é™¤" : "Remove from favorites"; } else { favBtn.classList.remove('saved'); icon.className = 'far fa-star'; favBtn.title = currentLanguage === 'zh' ? "åŠ å…¥æˆ‘çš„æœ€æ„›" : "Add to favorites"; } } updateFavButtonState(); favBtn.onclick = (e) => { e.preventDefault(); e.stopPropagation(); const wasAdded = toggleFavorite(data, imageUrl); updateFavButtonState(); if (isFavoriteView && !wasAdded) { card.style.transition = 'opacity 0.3s ease, transform 0.3s ease'; card.style.opacity = '0'; card.style.transform = 'translateY(-20px)'; setTimeout(() => { card.remove(); if (getFavorites().length === 0) { const noFavsText = document.querySelector('#no-favorites-text'); if(noFavsText) noFavsText.style.display = 'block'; } }, 300); } const feedbackMsg = wasAdded ? (currentLanguage === 'zh' ? 'å·²åŠ å…¥æ”¶è—ï¼' : 'Added to favorites!') : (currentLanguage === 'zh' ? 'å·²å¾æ”¶è—ç§»é™¤' : 'Removed from favorites'); showToast(feedbackMsg); }; if (isFavoriteView) { favReminder.style.display = 'none'; } setLanguage(currentLanguage); resultContainer.appendChild(card); }
        function showToast(message) { const toast = document.createElement('div'); toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all transform translate-x-full'; toast.textContent = message; document.body.appendChild(toast); setTimeout(() => { toast.classList.remove('translate-x-full'); }, 100); setTimeout(() => { toast.classList.add('translate-x-full'); setTimeout(() => toast.remove(), 300); }, 2000); }
        function showCookingTips() { initialContentContainer.style.display = 'none'; resultContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg"><div class="flex items-center justify-between mb-6"><h2 class="text-3xl font-bold text-gray-800">ğŸ‘¨â€ğŸ³ çƒ¹é¥ªæŠ€å·§å¤§å…¨</h2><button onclick="showInitialContent()" class="text-green-500 hover:text-green-600 font-medium"><i class="fas fa-arrow-left mr-2"></i>è¿”å›é¦–é¡µ</button></div><div class="space-y-6"><section class="border-l-4 border-green-500 pl-4"><h3 class="text-xl font-semibold mb-3">ğŸ”¥ ç«å€™æ§åˆ¶æŠ€å·§</h3><ul class="space-y-2 text-gray-700"><li><strong>å¤§ç«çˆ†ç‚’ï¼š</strong>é€‚åˆç»¿å¶è”¬èœï¼Œä¿æŒè„†å«©å£æ„Ÿå’Œé²œè‰³é¢œè‰²</li><li><strong>ä¸­ç«ç…ç‚¸ï¼š</strong>é±¼ç±»ã€è‚‰ç±»å¤–ç„¦å†…å«©çš„å…³é”®</li><li><strong>å°ç«æ…¢ç‚–ï¼š</strong>æ±¤å“ã€ç‚–èœå…¥å‘³çš„ç§˜è¯€</li><li><strong>ä½™æ¸©åˆ©ç”¨ï¼š</strong>å…³ç«åç”¨ä½™æ¸©ç„–ç…®ï¼ŒèŠ‚èƒ½åˆç¾å‘³</li></ul></section><section class="border-l-4 border-blue-500 pl-4"><h3 class="text-xl font-semibold mb-3">ğŸ§‚ è°ƒå‘³é»„é‡‘æ¯”ä¾‹</h3><div class="bg-blue-50 p-4 rounded-lg"><ul class="space-y-2 text-gray-700"><li><strong>ç³–é†‹æ¯”ä¾‹ï¼š</strong>ç³–1ï¼šé†‹2ï¼Œé…¸ç”œé€‚ä¸­</li><li><strong>è…Œåˆ¶è‚‰ç±»ï¼š</strong>ç›1%ï¼Œç³–0.5%ï¼Œæ–™é…’10%</li><li><strong>ç‚’èœç”¨ç›ï¼š</strong>500gèœå“ç”¨ç›3-5g</li><li><strong>æ±¤å“è°ƒå‘³ï¼š</strong>å…ˆæ·¡åæµ“ï¼Œé€æ­¥è°ƒæ•´</li></ul></div></section></div></div>`; }
        function showNutritionGuide() { initialContentContainer.style.display = 'none'; resultContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg"><div class="flex items-center justify-between mb-6"><h2 class="text-3xl font-bold text-gray-800">ğŸ¥‘ è¥å…»æ­é…æŒ‡å—</h2><button onclick="showInitialContent()" class="text-green-500 hover:text-green-600 font-medium"><i class="fas fa-arrow-left mr-2"></i>è¿”å›é¦–é¡µ</button></div><div class="space-y-6"><section class="border-l-4 border-green-500 pl-4"><h3 class="text-xl font-semibold mb-3">ğŸŒˆ å½©è™¹é¥®é£Ÿæ³•</h3><p class="text-gray-600">æ¯å¤©æ‘„å…¥ä¸åŒé¢œè‰²çš„è”¬æœï¼Œç¡®ä¿è¥å…»ç´ çš„å…¨é¢æ€§</p></section></div></div>`; }
        function showStorageGuide() { initialContentContainer.style.display = 'none'; resultContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg"><div class="flex items-center justify-between mb-6"><h2 class="text-3xl font-bold text-gray-800">ğŸ§Š é£Ÿæä¿å­˜ç§˜ç±</h2><button onclick="showInitialContent()" class="text-green-500 hover:text-green-600 font-medium"><i class="fas fa-arrow-left mr-2"></i>è¿”å›é¦–é¡µ</button></div><div class="space-y-6"><section class="border-l-4 border-green-500 pl-4"><h3 class="text-xl font-semibold mb-3">ğŸ¥¬ è”¬èœä¿å­˜æŠ€å·§</h3><p class="text-gray-600">ç§‘å­¦çš„ä¿å­˜æ–¹æ³•ï¼Œå»¶é•¿é£Ÿææ–°é²œåº¦</p></section></div></div>`; }
        function showSeasonalRecipes() { initialContentContainer.style.display = 'none'; resultContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg"><div class="flex items-center justify-between mb-6"><h2 class="text-3xl font-bold text-gray-800">ğŸŒ¸ æ—¶ä»¤é£Ÿè°±æ¨è</h2><button onclick="showInitialContent()" class="text-green-500 hover:text-green-600 font-medium"><i class="fas fa-arrow-left mr-2"></i>è¿”å›é¦–é¡µ</button></div><div class="space-y-6"><section class="border-l-4 border-pink-500 pl-4"><h3 class="text-xl font-semibold mb-3">ğŸŒ¸ æ˜¥å­£æ—¶ä»¤</h3><p class="text-gray-600">æ ¹æ®å­£èŠ‚æ¨èæœ€ä½³é£Ÿæå’Œèœå“</p></section></div></div>`; }
        function searchSeasonal(term) { mainInput.value = term; handleInitialInput(term); }
        function setupModals() { const modalLinks = { 'about-link': 'modal-about', 'faq-link': 'modal-faq', 'terms-link': 'modal-terms', 'privacy-link': 'modal-privacy' }; Object.entries(modalLinks).forEach(([linkId, modalId]) => { const link = document.getElementById(linkId); const modal = document.getElementById(modalId); if (link && modal) { link.addEventListener('click', (e) => { e.preventDefault(); modal.classList.add('active'); }); } }); document.querySelectorAll('.modal-overlay').forEach(modal => { modal.addEventListener('click', (e) => { if (e.target === modal) { modal.classList.remove('active'); } }); }); document.querySelectorAll('.modal-close-btn').forEach(btn => { btn.addEventListener('click', () => { btn.closest('.modal-overlay').classList.remove('active'); }); }); }
        function setupPwaInstall() { let deferredPrompt; const installHint = document.getElementById('install-hint'); window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; if (installHint) { console.log("PWA is installable, showing hint."); installHint.classList.remove('hidden'); } }); window.addEventListener('appinstalled', () => { if (installHint) { installHint.classList.add('hidden'); } console.log('PWA was installed'); }); }
        document.addEventListener('DOMContentLoaded', () => {
            setLanguage(currentLanguage);
            showInitialContent();
            setupModals();
            setupPwaInstall();
            recipeCache.preloadPopularRecipes();
            startBtn.addEventListener('click', () => handleInitialInput(mainInput.value));
            mainInput.addEventListener('keyup', (event) => { if (event.key === 'Enter') handleInitialInput(mainInput.value); });
            langSwitcherBtn.addEventListener('click', () => { const newLang = currentLanguage === 'zh' ? 'en' : 'zh'; setLanguage(newLang); });
            myFavoritesBtn.addEventListener('click', showFavorites);
            preferencesContainer.addEventListener('click', (event) => { if (event.target.classList.contains('preference-btn')) { event.target.classList.toggle('active'); } });
            setTimeout(() => { const stats = recipeCache.getStats(); console.log('ç¼“å­˜ç»Ÿè®¡:', stats); }, 2000);
        });
    </script>
</body>
</html>
```